#include "StdAfx.h"
#include ".\x2gunpcfunc.h"
#include "KTDGParticleSystem.h"

CX2GUNPCFunc::CX2GUNPCFunc(void)
{
	
	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_C_BOSS );
	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_A_NODROP );
	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_B_NODROP );
	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_C_NODROP );
	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );

	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_BENDERS_NORMAL );
	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_BENDERS_HARD );
	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_BENDERS_EXPERT );

	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_A );
	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_B );
	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_APPLE );

	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_BOSS );
    m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_BOSS_EASY );

	m_vecNpcIDForMonkeyApple.push_back( CX2UnitManager::NUI_MONKEY_ROLLING );

	
}

CX2GUNPCFunc::~CX2GUNPCFunc(void)
{
}

void CX2GUNPCFunc::SetNPC( CX2GUNPC* pNPC )
{
	KTDXPROFILE();

	if( pNPC == NULL )
		return;

	CX2UnitManager::NPC_UNIT_ID npcID = pNPC->GetNPCTemplet().m_nNPCUnitID;
	switch( npcID )
	{
	case CX2UnitManager::NUI_BEE:
    case CX2UnitManager::NUI_BEE_JUMP:
		{
			SET_START_FUNC(			npcID, "BEE_FLY",						CX2GUNPCFunc, BEE_FLY_STATE_START );
			SET_FRAME_MOVE_FUNC(	npcID, "BEE_FLY",						CX2GUNPCFunc, BEE_FLY_FRAME_MOVE );
			SET_END_FUNC(			npcID, "BEE_JUMP_DOWN",				CX2GUNPCFunc, BEE_JUMP_DOWN_STATE_END );
			SET_END_FUNC(			npcID, "BEE_JUMP_DOWN_DIR",			CX2GUNPCFunc, BEE_JUMP_DOWN_DIR_STATE_END );
			SET_FRAME_MOVE_FUNC(	npcID, "BEE_DAMAGE",				    CX2GUNPCFunc, BEE_DAMAGE_SMALL_FRAME_MOVE );
			SET_FRAME_MOVE_FUNC(	npcID, "BEE_DAMAGE_DOWN",				CX2GUNPCFunc, BEE_DAMAGE_DOWN_FRAME_MOVE );
			SET_FRAME_MOVE_FUNC(	npcID, "BEE_DAMAGE_AIR_DOWN_LANDING",	CX2GUNPCFunc, BEE_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
			SET_START_FUNC(			npcID, "BEE_DYING_LAND",				CX2GUNPCFunc, BEE_DYING_LAND_STATE_START );
		}
		break;
    
    case CX2UnitManager::NUI_BEE_NODROP:
        {
            SET_END_FUNC(           npcID, "BEE_JUMP_DOWN",         CX2GUNPCFunc, BEE_NODROP_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "BEE_JUMP_DOWN_DIR",     CX2GUNPCFunc, BEE_NODROP_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_DAMAGE",            CX2GUNPCFunc, BEE_NODROP_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_DAMAGE_DOWN",       CX2GUNPCFunc, BEE_NODROP_DAMAGE_DOWN_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, BEE_NODROP_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_START_FUNC(         npcID, "BEE_DYING_LAND",        CX2GUNPCFunc, BEE_NODROP_DYING_LAND_STATE_START );
            SET_START_FUNC(         npcID, "BEE_DYING_SKY",         CX2GUNPCFunc, BEE_NODROP_DYING_LAND_STATE_START );
        }
        break;

    case CX2UnitManager::NUI_BEEBOMB:
        {
            SET_END_FUNC(           npcID, "BEE_BOMB_JUMP_DOWN",           CX2GUNPCFunc, BEE_BOMB_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "BEE_BOMB_JUMP_DOWN_DIR",       CX2GUNPCFunc, BEE_BOMB_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_BOMB_ANGRY",               CX2GUNPCFunc, BEE_BOMB_ANGRY_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_BOMB_BOMB_ATTACK",         CX2GUNPCFunc, BEE_BOMB_BOMB_ATTACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_BOMB_DAMAGE",              CX2GUNPCFunc, BEE_BOMB_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_BOMB_DAMAGE_DOWN",         CX2GUNPCFunc, BEE_BOMB_DAMAGE_DOWN_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_BOMB_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, BEE_BOMB_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_START_FUNC(         npcID, "BEE_BOMB_BOMB_EXPLODE",        CX2GUNPCFunc, BEE_BOMB_BOMB_EXPLODE_STATE_START );
            SET_START_FUNC(         npcID, "BEE_BOMB_DYING_LAND",          CX2GUNPCFunc, BEE_BOMB_DYING_LAND_STATE_START );
            SET_START_FUNC(         npcID, "BEE_BOMB_DYING_SKY",           CX2GUNPCFunc, BEE_BOMB_DYING_LAND_STATE_START );
        }
        break;

    case CX2UnitManager::NUI_BEEBOMB_NODROP:
        {
            SET_END_FUNC(           npcID, "BEE_JUMP_DOWN",        CX2GUNPCFunc, BEE_BOMB_NODROP_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "BEE_JUMP_DOWN_DIR",    CX2GUNPCFunc, BEE_BOMB_NODROP_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_ANGRY",            CX2GUNPCFunc, BEE_BOMB_NODROP_ANGRY_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_BOMB_ATTACK",      CX2GUNPCFunc, BEE_BOMB_NODROP_BOMB_ATTACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_DAMAGE",           CX2GUNPCFunc, BEE_BOMB_NODROP_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_DAMAGE_DOWN",      CX2GUNPCFunc, BEE_BOMB_NODROP_DAMAGE_DOWN_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, BEE_BOMB_NODROP_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_START_FUNC(         npcID, "BEE_BOMB_EXPLODE",     CX2GUNPCFunc, BEE_BOMB_NODROP_BOMB_EXPLODE_STATE_START );
            SET_START_FUNC(         npcID, "BEE_DYING_LAND",       CX2GUNPCFunc, BEE_BOMB_NODROP_DYING_LAND_STATE_START );
            SET_START_FUNC(         npcID, "BEE_DYING_SKY",        CX2GUNPCFunc, BEE_BOMB_NODROP_DYING_LAND_STATE_START );
        }
        break;

    case CX2UnitManager::NUI_BEEPOISON:
        {
            SET_END_FUNC(           npcID, "BEE_POISON_JUMP_DOWN",             CX2GUNPCFunc, BEE_POISON_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "BEE_POISON_JUMP_DOWN_DIR",         CX2GUNPCFunc, BEE_POISON_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_POISON_DAMAGE",                CX2GUNPCFunc, BEE_POISON_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_POISON_DAMAGE_DOWN",           CX2GUNPCFunc, BEE_POISON_DAMAGE_DOWN_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_POISON_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, BEE_POISON_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_START_FUNC(         npcID, "BEE_POISON_DYING_LAND",            CX2GUNPCFunc, BEE_POISON_DYING_LAND_STATE_START );
            SET_START_FUNC(         npcID, "BEE_POISON_DYING_SKY",             CX2GUNPCFunc, BEE_POISON_DYING_LAND_STATE_START );
        }
        break;

    case CX2UnitManager::NUI_BEEPOISON_NODROP:
        {
            SET_END_FUNC(           npcID, "BEE_POISON_JUMP_DOWN",             CX2GUNPCFunc, BEE_POISON_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "BEE_POISON_JUMP_DOWN_DIR",         CX2GUNPCFunc, BEE_POISON_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_POISON_DAMAGE",                CX2GUNPCFunc, BEE_POISON_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_POISON_DAMAGE_DOWN",           CX2GUNPCFunc, BEE_POISON_DAMAGE_DOWN_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_POISON_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, BEE_POISON_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_START_FUNC(         npcID, "BEE_POISON_DYING_LAND",            CX2GUNPCFunc, BEE_POISON_DYING_LAND_STATE_START );
            SET_START_FUNC(         npcID, "BEE_POISON_DYING_SKY",             CX2GUNPCFunc, BEE_POISON_DYING_LAND_STATE_START );
        }
        break;

    case CX2UnitManager::NUI_BEE_ASSAULT:
        {
            SET_END_FUNC(           npcID, "BEE_ASSAULT_JUMP_DOWN",            CX2GUNPCFunc, BEE_ASSAULT_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "BEE_ASSAULT_JUMP_DOWN_DIR",        CX2GUNPCFunc, BEE_ASSAULT_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_ASSAULT_BOMB_ATTACK",          CX2GUNPCFunc, BEE_ASSAULT_BOMB_ATTACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_ASSAULT_DAMAGE",               CX2GUNPCFunc, BEE_ASSAULT_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_ASSAULT_DAMAGE_DOWN",          CX2GUNPCFunc, BEE_ASSAULT_DAMAGE_DOWN_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_ASSAULT_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, BEE_ASSAULT_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_START_FUNC(         npcID, "BEE_ASSAULT_DYING_LAND",           CX2GUNPCFunc, BEE_ASSAULT_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BEE_ASSAULT_DYING_SKY",            CX2GUNPCFunc, BEE_ASSAULT_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_BEEHOUSE:
        {
            SET_START_FUNC(         npcID, "BEE_HOUSE_START",                  CX2GUNPCFunc, BEE_HOUSE_START_STATE_START );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_HOUSE_RESPAWN",                CX2GUNPCFunc, BEE_HOUSE_RESPAWN_FRAME_MOVE );
            SET_START_FUNC(         npcID, "BEE_HOUSE_DYING",                  CX2GUNPCFunc, BEE_HOUSE_DYING_STATE_START );
        }
        break;

    case CX2UnitManager::NUI_BEEBOMBHOUSE:
        {
            SET_START_FUNC(         npcID, "BEE_BOMB_HOUSE_START",             CX2GUNPCFunc, BEE_BOMB_HOUSE_START_STATE_START );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_BOMB_HOUSE_RESPAWN",           CX2GUNPCFunc, BEE_BOMB_HOUSE_RESPAWN_FRAME_MOVE );
            SET_START_FUNC(         npcID, "BEE_BOMB_HOUSE_DYING",             CX2GUNPCFunc, BEE_BOMB_HOUSE_DYING_STATE_START );
        }
        break;

    case CX2UnitManager::NUI_BEEPOISONHOUSE:
        {
            SET_START_FUNC(         npcID, "BEE_POISON_HOUSE_START",           CX2GUNPCFunc, BEE_POISON_HOUSE_START_STATE_START );
            SET_FRAME_MOVE_FUNC(    npcID, "BEE_POISON_HOUSE_RESPAWN",         CX2GUNPCFunc, BEE_POISON_HOUSE_RESPAWN_FRAME_MOVE );
            SET_START_FUNC(         npcID, "BEE_POISON_HOUSE_DYING",           CX2GUNPCFunc, BEE_POISON_HOUSE_DYING_STATE_START );
        }
        break;
    
    case CX2UnitManager::NUI_MONKEY_A:
        {
            SET_FRAME_MOVE_FUNC(	npcID, "MONKEY_A_WAIT2",				CX2GUNPCFunc, MONKEY_A_WAIT2_FRAME_MOVE );
            SET_END_FUNC(			npcID, "MONKEY_A_WALK",				CX2GUNPCFunc, MONKEY_A_WALK_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_WAIT3",               CX2GUNPCFunc, MONKEY_A_WAIT3_FRAME_MOVE );
            SET_END_FUNC(           npcID, "MONKEY_A_JUMP_DOWN",           CX2GUNPCFunc, MONKEY_A_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "MONKEY_A_JUMP_DOWN_DIR",       CX2GUNPCFunc, MONKEY_A_JUMP_DOWN_DIR_STATE_END );

			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_FLY_READY",			CX2GUNPCFunc, MONKEY_A_FLY_READY_FRAME_MOVE );
			

			SET_START_FUNC(         npcID, "MONKEY_A_FLY",					CX2GUNPCFunc, MONKEY_A_FLY_STATE_START);
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_FLY",					CX2GUNPCFunc, MONKEY_A_FLY_FRAME_MOVE);
			

            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_DAMAGE_SMALL",        CX2GUNPCFunc, MONKEY_A_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_DAMAGE_BIG",          CX2GUNPCFunc, MONKEY_A_DAMAGE_BIG_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_DAMAGE_DOWN_FRONT",   CX2GUNPCFunc, MONKEY_A_DAMAGE_DOWN_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_DAMAGE_DOWN_BACK",    CX2GUNPCFunc, MONKEY_A_DAMAGE_DOWN_BACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MONKEY_A_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_STAND_UP_ATTACK_FRONT",   CX2GUNPCFunc, MONKEY_A_STAND_UP_ATTACK_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_STAND_UP_ATTACK_BACK",    CX2GUNPCFunc, MONKEY_A_STAND_UP_ATTACK_BACK_FRAME_MOVE );
            SET_START_FUNC(         npcID, "MONKEY_A_DYING_LAND_FRONT",    CX2GUNPCFunc, MONKEY_A_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_A_DYING_LAND_BACK",     CX2GUNPCFunc, MONKEY_A_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_A_DYING_SKY",           CX2GUNPCFunc, MONKEY_A_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_MONKEY_A_NODROP:
        {
            SET_FRAME_MOVE_FUNC(	npcID, "MONKEY_A_WAIT2",				CX2GUNPCFunc, MONKEY_A_NODROP_WAIT2_FRAME_MOVE );
            SET_END_FUNC(			npcID, "MONKEY_A_WALK",				CX2GUNPCFunc, MONKEY_A_NODROP_WALK_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_WAIT3",               CX2GUNPCFunc, MONKEY_A_NODROP_WAIT3_FRAME_MOVE );
            SET_END_FUNC(           npcID, "MONKEY_A_JUMP_DOWN",           CX2GUNPCFunc, MONKEY_A_NODROP_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "MONKEY_A_JUMP_DOWN_DIR",       CX2GUNPCFunc, MONKEY_A_NODROP_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_DAMAGE_SMALL",        CX2GUNPCFunc, MONKEY_A_NODROP_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_DAMAGE_BIG",          CX2GUNPCFunc, MONKEY_A_NODROP_DAMAGE_BIG_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_DAMAGE_DOWN_FRONT",   CX2GUNPCFunc, MONKEY_A_NODROP_DAMAGE_DOWN_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_DAMAGE_DOWN_BACK",    CX2GUNPCFunc, MONKEY_A_NODROP_DAMAGE_DOWN_BACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MONKEY_A_NODROP_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_STAND_UP_ATTACK_FRONT",   CX2GUNPCFunc, MONKEY_A_NODROP_STAND_UP_ATTACK_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_A_STAND_UP_ATTACK_BACK",    CX2GUNPCFunc, MONKEY_A_NODROP_STAND_UP_ATTACK_BACK_FRAME_MOVE );
            SET_START_FUNC(         npcID, "MONKEY_A_DYING_LAND_FRONT",    CX2GUNPCFunc, MONKEY_A_NODROP_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_A_DYING_LAND_BACK",     CX2GUNPCFunc, MONKEY_A_NODROP_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_A_DYING_SKY",           CX2GUNPCFunc, MONKEY_A_NODROP_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_MONKEY_B:
        {
            SET_FRAME_MOVE_FUNC(	npcID, "MONKEY_B_WAIT2",				CX2GUNPCFunc, MONKEY_B_WAIT2_FRAME_MOVE );
            SET_END_FUNC(			npcID, "MONKEY_B_WALK",				CX2GUNPCFunc, MONKEY_B_WALK_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_WAIT3",               CX2GUNPCFunc, MONKEY_B_WAIT3_FRAME_MOVE );
            SET_END_FUNC(           npcID, "MONKEY_B_JUMP_DOWN",           CX2GUNPCFunc, MONKEY_B_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "MONKEY_B_JUMP_DOWN_DIR",       CX2GUNPCFunc, MONKEY_B_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_PUNCH_PUNCH_ATTACK",  CX2GUNPCFunc, MONKEY_B_PUNCH_PUNCH_ATTACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_DAMAGE_SMALL",        CX2GUNPCFunc, MONKEY_B_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_DAMAGE_BIG",          CX2GUNPCFunc, MONKEY_B_DAMAGE_BIG_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_DAMAGE_DOWN_FRONT",   CX2GUNPCFunc, MONKEY_B_DAMAGE_DOWN_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_DAMAGE_DOWN_BACK",    CX2GUNPCFunc, MONKEY_B_DAMAGE_DOWN_BACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MONKEY_B_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_STAND_UP_ATTACK_FRONT",   CX2GUNPCFunc, MONKEY_B_STAND_UP_ATTACK_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_STAND_UP_ATTACK_BACK",    CX2GUNPCFunc, MONKEY_B_STAND_UP_ATTACK_BACK_FRAME_MOVE );
            SET_START_FUNC(         npcID, "MONKEY_B_DYING_LAND_FRONT",    CX2GUNPCFunc, MONKEY_B_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_B_DYING_LAND_BACK",     CX2GUNPCFunc, MONKEY_B_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_B_DYING_SKY",           CX2GUNPCFunc, MONKEY_B_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_MONKEY_B_NODROP:
        {
            SET_FRAME_MOVE_FUNC(	npcID, "MONKEY_B_WAIT2",				CX2GUNPCFunc, MONKEY_B_NODROP_WAIT2_FRAME_MOVE );
            SET_END_FUNC(			npcID, "MONKEY_B_WALK",				CX2GUNPCFunc, MONKEY_B_NODROP_WALK_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_WAIT3",               CX2GUNPCFunc, MONKEY_B_NODROP_WAIT3_FRAME_MOVE );
            SET_END_FUNC(           npcID, "MONKEY_B_JUMP_DOWN",           CX2GUNPCFunc, MONKEY_B_NODROP_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "MONKEY_B_JUMP_DOWN_DIR",       CX2GUNPCFunc, MONKEY_B_NODROP_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_PUNCH_PUNCH_ATTACK",  CX2GUNPCFunc, MONKEY_B_PUNCH_PUNCH_ATTACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_DAMAGE_SMALL",        CX2GUNPCFunc, MONKEY_B_NODROP_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_DAMAGE_BIG",          CX2GUNPCFunc, MONKEY_B_NODROP_DAMAGE_BIG_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_DAMAGE_DOWN_FRONT",   CX2GUNPCFunc, MONKEY_B_NODROP_DAMAGE_DOWN_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_DAMAGE_DOWN_BACK",    CX2GUNPCFunc, MONKEY_B_NODROP_DAMAGE_DOWN_BACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MONKEY_B_NODROP_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_STAND_UP_ATTACK_FRONT",   CX2GUNPCFunc, MONKEY_B_NODROP_STAND_UP_ATTACK_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_B_STAND_UP_ATTACK_BACK",    CX2GUNPCFunc, MONKEY_B_NODROP_STAND_UP_ATTACK_BACK_FRAME_MOVE );
            SET_START_FUNC(         npcID, "MONKEY_B_DYING_LAND_FRONT",    CX2GUNPCFunc, MONKEY_B_NODROP_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_B_DYING_LAND_BACK",     CX2GUNPCFunc, MONKEY_B_NODROP_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_B_DYING_SKY",           CX2GUNPCFunc, MONKEY_B_NODROP_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_MONKEY_APPLE:
        {
            SET_FRAME_MOVE_FUNC(	npcID, "MONKEY_APPLE_WAIT2",				CX2GUNPCFunc, MONKEY_APPLE_WAIT2_FRAME_MOVE );
            SET_END_FUNC(			npcID, "MONKEY_APPLE_WALK",				CX2GUNPCFunc, MONKEY_APPLE_WALK_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_WAIT3",               CX2GUNPCFunc, MONKEY_APPLE_WAIT3_FRAME_MOVE );
            SET_END_FUNC(           npcID, "MONKEY_APPLE_JUMP_DOWN",           CX2GUNPCFunc, MONKEY_APPLE_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "MONKEY_APPLE_JUMP_DOWN_DIR",       CX2GUNPCFunc, MONKEY_APPLE_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_APPLE_ATTACK",        CX2GUNPCFunc, MONKEY_APPLE_APPLE_ATTACK_FRAME_MOVE );

			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_WAIT",				CX2GUNPCFunc, MONKEY_APPLE_WAIT_FRAME_MOVE );
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_WALK",				CX2GUNPCFunc, MONKEY_APPLE_WALK_FRAME_MOVE );
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_RIDE_HORSE",			CX2GUNPCFunc, MONKEY_APPLE_RIDE_HORSE_STATE_START );
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_RIDE_HORSE",			CX2GUNPCFunc, MONKEY_APPLE_RIDE_HORSE_FRAME_MOVE );
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_RIDE_APPLE_ATTACK",   CX2GUNPCFunc, MONKEY_APPLE_RIDE_APPLE_ATTACK_FRAME_MOVE );
			SET_END_FUNC(			npcID, "MONKEY_APPLE_LEAVE_HORSE",			CX2GUNPCFunc, MONKEY_APPLE_LEAVE_HORSE_STATE_END );

            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_DAMAGE_SMALL",        CX2GUNPCFunc, MONKEY_APPLE_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_DAMAGE_BIG",          CX2GUNPCFunc, MONKEY_APPLE_DAMAGE_BIG_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_DAMAGE_DOWN_FRONT",   CX2GUNPCFunc, MONKEY_APPLE_DAMAGE_DOWN_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_DAMAGE_DOWN_BACK",    CX2GUNPCFunc, MONKEY_APPLE_DAMAGE_DOWN_BACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MONKEY_APPLE_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_STAND_UP_ATTACK_FRONT",   CX2GUNPCFunc, MONKEY_APPLE_STAND_UP_ATTACK_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_STAND_UP_ATTACK_BACK",    CX2GUNPCFunc, MONKEY_APPLE_STAND_UP_ATTACK_BACK_FRAME_MOVE );
            SET_START_FUNC(         npcID, "MONKEY_APPLE_DYING_LAND_FRONT",    CX2GUNPCFunc, MONKEY_APPLE_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_APPLE_DYING_LAND_BACK",     CX2GUNPCFunc, MONKEY_APPLE_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_APPLE_DYING_SKY",           CX2GUNPCFunc, MONKEY_APPLE_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_MONKEY_APPLE_NODROP:
        {
            SET_FRAME_MOVE_FUNC(	npcID, "MONKEY_APPLE_WAIT2",				CX2GUNPCFunc, MONKEY_APPLE_NODROP_WAIT2_FRAME_MOVE );
            SET_END_FUNC(			npcID, "MONKEY_APPLE_WALK",				CX2GUNPCFunc, MONKEY_APPLE_NODROP_WALK_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_WAIT3",               CX2GUNPCFunc, MONKEY_APPLE_NODROP_WAIT3_FRAME_MOVE );
            SET_END_FUNC(           npcID, "MONKEY_APPLE_JUMP_DOWN",           CX2GUNPCFunc, MONKEY_APPLE_NODROP_JUMP_DOWN_STATE_END );
            SET_END_FUNC(           npcID, "MONKEY_APPLE_JUMP_DOWN_DIR",       CX2GUNPCFunc, MONKEY_APPLE_NODROP_JUMP_DOWN_DIR_STATE_END );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_APPLE_ATTACK",        CX2GUNPCFunc, MONKEY_APPLE_NODROP_APPLE_ATTACK_FRAME_MOVE );

			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_WAIT",				CX2GUNPCFunc, MONKEY_APPLE_WAIT_FRAME_MOVE );
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_WALK",				CX2GUNPCFunc, MONKEY_APPLE_WALK_FRAME_MOVE );
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_RIDE_HORSE",			CX2GUNPCFunc, MONKEY_APPLE_RIDE_HORSE_STATE_START );
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_RIDE_HORSE",			CX2GUNPCFunc, MONKEY_APPLE_RIDE_HORSE_FRAME_MOVE );
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_RIDE_APPLE_ATTACK",   CX2GUNPCFunc, MONKEY_APPLE_RIDE_APPLE_ATTACK_FRAME_MOVE );
			SET_END_FUNC(			npcID, "MONKEY_APPLE_LEAVE_HORSE",			CX2GUNPCFunc, MONKEY_APPLE_LEAVE_HORSE_STATE_END );

            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_DAMAGE_SMALL",        CX2GUNPCFunc, MONKEY_APPLE_NODROP_DAMAGE_SMALL_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_DAMAGE_BIG",          CX2GUNPCFunc, MONKEY_APPLE_NODROP_DAMAGE_BIG_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_DAMAGE_DOWN_FRONT",   CX2GUNPCFunc, MONKEY_APPLE_NODROP_DAMAGE_DOWN_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_DAMAGE_DOWN_BACK",    CX2GUNPCFunc, MONKEY_APPLE_NODROP_DAMAGE_DOWN_BACK_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MONKEY_APPLE_NODROP_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_STAND_UP_ATTACK_FRONT",   CX2GUNPCFunc, MONKEY_APPLE_NODROP_STAND_UP_ATTACK_FRONT_FRAME_MOVE );
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_APPLE_STAND_UP_ATTACK_BACK",    CX2GUNPCFunc, MONKEY_APPLE_NODROP_STAND_UP_ATTACK_BACK_FRAME_MOVE );
            SET_START_FUNC(         npcID, "MONKEY_APPLE_DYING_LAND_FRONT",    CX2GUNPCFunc, MONKEY_APPLE_NODROP_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_APPLE_DYING_LAND_BACK",     CX2GUNPCFunc, MONKEY_APPLE_NODROP_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_APPLE_DYING_SKY",           CX2GUNPCFunc, MONKEY_APPLE_NODROP_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_MONKEY_BOMB:
        {
            SET_START_FUNC(         npcID, "MONKEY_BOMB_SIEGE_WAIT",           CX2GUNPCFunc, MONKEY_BOMB_SIEGE_WAIT_STATE_START);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_SIEGE_BOMB_ATTACK",    CX2GUNPCFunc, MONKEY_BOMB_SIEGE_BOMB_ATTACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "MONKEY_BOMB_WAIT",                 CX2GUNPCFunc, MONKEY_BOMB_WAIT_STATE_START);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_WAIT2",                CX2GUNPCFunc, MONKEY_BOMB_WAIT2_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_WAIT3",                CX2GUNPCFunc, MONKEY_BOMB_WAIT3_FRAME_MOVE);
            SET_END_FUNC(           npcID, "MONKEY_BOMB_WALK",                 CX2GUNPCFunc, MONKEY_BOMB_WALK_STATE_END);
            SET_END_FUNC(           npcID, "MONKEY_BOMB_JUMP_DOWN",            CX2GUNPCFunc, MONKEY_BOMB_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "MONKEY_BOMB_JUMP_DOWN_DIR",        CX2GUNPCFunc, MONKEY_BOMB_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_BOMB_ATTACK",          CX2GUNPCFunc, MONKEY_BOMB_BOMB_ATTACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_DAMAGE_SMALL",         CX2GUNPCFunc, MONKEY_BOMB_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_DAMAGE_BIG",           CX2GUNPCFunc, MONKEY_BOMB_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_DAMAGE_DOWN_FRONT",    CX2GUNPCFunc, MONKEY_BOMB_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_DAMAGE_DOWN_BACK",     CX2GUNPCFunc, MONKEY_BOMB_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MONKEY_BOMB_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_STAND_UP_ATTACK_FRONT",CX2GUNPCFunc, MONKEY_BOMB_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOMB_STAND_UP_ATTACK_BACK", CX2GUNPCFunc, MONKEY_BOMB_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "MONKEY_BOMB_DYING_LAND_FRONT",     CX2GUNPCFunc, MONKEY_BOMB_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_BOMB_DYING_LAND_BACK",      CX2GUNPCFunc, MONKEY_BOMB_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_BOMB_DYING_SKY",            CX2GUNPCFunc, MONKEY_BOMB_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_SMALLGATE_GREEN:
        {
            SET_START_FUNC(         npcID, "SMALL_GATE_GREEN_WAIT",            CX2GUNPCFunc, SMALL_GATE_GREEN_WAIT_START_STATE);
        }
        break;

    case CX2UnitManager::NUI_SMALLGATE_YELLOW:
        {
            SET_START_FUNC(         npcID, "SMALL_GATE_YELLOW_WAIT",           CX2GUNPCFunc, SMALL_GATE_YELLOW_WAIT_START_STATE);
        }
        break;

    case CX2UnitManager::NUI_SMALLGATE_RED:
        {
            SET_START_FUNC(         npcID, "SMALL_GATE_RED_WAIT",           CX2GUNPCFunc, SMALL_GATE_RED_WAIT_START_STATE);
        }
        break;

    case CX2UnitManager::NUI_SMALLGATE_POST:
        {
            SET_START_FUNC(         npcID, "SMALL_GATE_POST_BROKEN",           CX2GUNPCFunc, SMALL_GATE_POST_BROKEN_START_STATE);
        }
        break;

    case CX2UnitManager::NUI_BENDERS_NORMAL:
        {            
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WAIT",                     CX2GUNPCFunc, BENDERS_WAIT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_WALK_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN",                CX2GUNPCFunc, BENDERS_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN_DIR",            CX2GUNPCFunc, BENDERS_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DASH",                     CX2GUNPCFunc, BENDERS_DASH_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_COMBO2",                   CX2GUNPCFunc, BENDERS_COMBO2_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_SUMMON_MONSTER",           CX2GUNPCFunc, BENDERS_SUMMON_MONSTER_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_SMALL",             CX2GUNPCFunc, BENDERS_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_BIG",               CX2GUNPCFunc, BENDERS_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_FRONT",        CX2GUNPCFunc, BENDERS_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_BACK",         CX2GUNPCFunc, BENDERS_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_AIR_DOWN_LANDING",  CX2GUNPCFunc, BENDERS_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_FRONT",    CX2GUNPCFunc, BENDERS_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_BACK",     CX2GUNPCFunc, BENDERS_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_FRONT",         CX2GUNPCFunc, BENDERS_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_BACK",          CX2GUNPCFunc, BENDERS_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_SKY",                CX2GUNPCFunc, BENDERS_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_BENDERS_HARD:
        {            
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WAIT",                     CX2GUNPCFunc, BENDERS_HARD_WAIT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_HARD_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_HARD_WALK_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN",                CX2GUNPCFunc, BENDERS_HARD_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN_DIR",            CX2GUNPCFunc, BENDERS_HARD_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DASH",                     CX2GUNPCFunc, BENDERS_HARD_DASH_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_COMBO2",                   CX2GUNPCFunc, BENDERS_HARD_COMBO2_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_SUMMON_MONSTER",           CX2GUNPCFunc, BENDERS_HARD_SUMMON_MONSTER_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_SMALL",             CX2GUNPCFunc, BENDERS_HARD_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_BIG",               CX2GUNPCFunc, BENDERS_HARD_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_FRONT",        CX2GUNPCFunc, BENDERS_HARD_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_BACK",         CX2GUNPCFunc, BENDERS_HARD_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_AIR_DOWN_LANDING",  CX2GUNPCFunc, BENDERS_HARD_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_FRONT",    CX2GUNPCFunc, BENDERS_HARD_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_BACK",     CX2GUNPCFunc, BENDERS_HARD_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_FRONT",         CX2GUNPCFunc, BENDERS_HARD_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_BACK",          CX2GUNPCFunc, BENDERS_HARD_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_SKY",                CX2GUNPCFunc, BENDERS_HARD_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_BENDERS_EXPERT:
        {            
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WAIT",                     CX2GUNPCFunc, BENDERS_EXPERT_WAIT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_EXPERT_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_EXPERT_WALK_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN",                CX2GUNPCFunc, BENDERS_EXPERT_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN_DIR",            CX2GUNPCFunc, BENDERS_EXPERT_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DASH",                     CX2GUNPCFunc, BENDERS_EXPERT_DASH_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_COMBO2",                   CX2GUNPCFunc, BENDERS_EXPERT_COMBO2_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_SUMMON_MONSTER",           CX2GUNPCFunc, BENDERS_EXPERT_SUMMON_MONSTER_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_SMALL",             CX2GUNPCFunc, BENDERS_EXPERT_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_BIG",               CX2GUNPCFunc, BENDERS_EXPERT_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_FRONT",        CX2GUNPCFunc, BENDERS_EXPERT_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_BACK",         CX2GUNPCFunc, BENDERS_EXPERT_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_AIR_DOWN_LANDING",  CX2GUNPCFunc, BENDERS_EXPERT_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_FRONT",    CX2GUNPCFunc, BENDERS_EXPERT_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_BACK",     CX2GUNPCFunc, BENDERS_EXPERT_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_FRONT",         CX2GUNPCFunc, BENDERS_EXPERT_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_BACK",          CX2GUNPCFunc, BENDERS_EXPERT_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_SKY",                CX2GUNPCFunc, BENDERS_EXPERT_DYING_LAND_STATE_START);
        }
        break;
        
    case CX2UnitManager::NUI_BENDERS_B:
        {            
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_WAIT",                     CX2GUNPCFunc, BENDERS_B_WAIT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_WALK",                     CX2GUNPCFunc, BENDERS_B_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "BENDERS_B_WALK",                     CX2GUNPCFunc, BENDERS_B_WALK_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_B_JUMP_DOWN",                CX2GUNPCFunc, BENDERS_B_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_B_JUMP_DOWN_DIR",            CX2GUNPCFunc, BENDERS_B_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_DASH",                     CX2GUNPCFunc, BENDERS_B_DASH_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_COMBO2",                   CX2GUNPCFunc, BENDERS_B_COMBO2_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_SUMMON_MONSTER",           CX2GUNPCFunc, BENDERS_B_SUMMON_MONSTER_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_DAMAGE_SMALL",             CX2GUNPCFunc, BENDERS_B_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_DAMAGE_BIG",               CX2GUNPCFunc, BENDERS_B_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_DAMAGE_DOWN_FRONT",        CX2GUNPCFunc, BENDERS_B_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_DAMAGE_DOWN_BACK",         CX2GUNPCFunc, BENDERS_B_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_DAMAGE_AIR_DOWN_LANDING",  CX2GUNPCFunc, BENDERS_B_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_STAND_UP_ATTACK_FRONT",    CX2GUNPCFunc, BENDERS_B_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_B_STAND_UP_ATTACK_BACK",     CX2GUNPCFunc, BENDERS_B_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "BENDERS_B_DYING_LAND_FRONT",         CX2GUNPCFunc, BENDERS_B_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_B_DYING_LAND_BACK",          CX2GUNPCFunc, BENDERS_B_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_B_DYING_SKY",                CX2GUNPCFunc, BENDERS_B_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_BENDERS_UPGRADE_NORMAL:
        {            
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WAIT",                     CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_WAIT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_WALK_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN",                CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN_DIR",            CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DASH",                     CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_DASH_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_COMBO2",                   CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_COMBO2_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_COMBO_A",                  CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_COMBO_A_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_SUMMON_MONSTER",           CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_SUMMON_MONSTER_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_SMALL",             CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_BIG",               CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_FRONT",        CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_BACK",         CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_AIR_DOWN_LANDING",  CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_FRONT",    CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_BACK",     CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_FRONT",         CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_BACK",          CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_SKY",                CX2GUNPCFunc, BENDERS_UPGRADE_NORMAL_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_BENDERS_UPGRADE_HARD:
        {            
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WAIT",                     CX2GUNPCFunc, BENDERS_UPGRADE_HARD_WAIT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_UPGRADE_HARD_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_UPGRADE_HARD_WALK_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN",                CX2GUNPCFunc, BENDERS_UPGRADE_HARD_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN_DIR",            CX2GUNPCFunc, BENDERS_UPGRADE_HARD_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DASH",                     CX2GUNPCFunc, BENDERS_UPGRADE_HARD_DASH_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_COMBO2",                   CX2GUNPCFunc, BENDERS_UPGRADE_HARD_COMBO2_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_COMBO_A",                  CX2GUNPCFunc, BENDERS_UPGRADE_HARD_COMBO_A_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_SUMMON_MONSTER",           CX2GUNPCFunc, BENDERS_UPGRADE_HARD_SUMMON_MONSTER_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_SMALL",             CX2GUNPCFunc, BENDERS_UPGRADE_HARD_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_BIG",               CX2GUNPCFunc, BENDERS_UPGRADE_HARD_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_FRONT",        CX2GUNPCFunc, BENDERS_UPGRADE_HARD_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_BACK",         CX2GUNPCFunc, BENDERS_UPGRADE_HARD_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_AIR_DOWN_LANDING",  CX2GUNPCFunc, BENDERS_UPGRADE_HARD_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_FRONT",    CX2GUNPCFunc, BENDERS_UPGRADE_HARD_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_BACK",     CX2GUNPCFunc, BENDERS_UPGRADE_HARD_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_FRONT",         CX2GUNPCFunc, BENDERS_UPGRADE_HARD_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_BACK",          CX2GUNPCFunc, BENDERS_UPGRADE_HARD_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_SKY",                CX2GUNPCFunc, BENDERS_UPGRADE_HARD_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_BENDERS_UPGRADE_EXPERT:
        {            
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WAIT",                     CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_WAIT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "BENDERS_WALK",                     CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_WALK_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN",                CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "BENDERS_JUMP_DOWN_DIR",            CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DASH",                     CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_DASH_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_COMBO2",                   CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_COMBO2_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_COMBO_A",                  CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_COMBO_A_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_SUMMON_MONSTER",           CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_SUMMON_MONSTER_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_SMALL",             CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_BIG",               CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_FRONT",        CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_DOWN_BACK",         CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_DAMAGE_AIR_DOWN_LANDING",  CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_FRONT",    CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "BENDERS_STAND_UP_ATTACK_BACK",     CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_FRONT",         CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_LAND_BACK",          CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "BENDERS_DYING_SKY",                CX2GUNPCFunc, BENDERS_UPGRADE_EXPERT_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_CHAINGATE_GREEN:
        {
            SET_START_FUNC(         npcID, "CHAIN_GATE_GREEN_WAIT",            CX2GUNPCFunc, CHAIN_GATE_GREEN_WAIT_START_STATE);
        }
        break;

    case CX2UnitManager::NUI_CHAINGATE_YELLOW:
        {
            SET_START_FUNC(         npcID, "CHAIN_GATE_YELLOW_WAIT",            CX2GUNPCFunc, CHAIN_GATE_YELLOW_WAIT_START_STATE);
        }
        break;

    case CX2UnitManager::NUI_CHAINGATE_RED:
        {
            SET_START_FUNC(         npcID, "CHAIN_GATE_GREEN_WAIT",            CX2GUNPCFunc, CHAIN_GATE_RED_WAIT_START_STATE);
        }
        break;

    case CX2UnitManager::NUI_CHAINGATE_EXTRA:
        {
            SET_START_FUNC(         npcID, "CHAIN_GATE_GREEN_WAIT",            CX2GUNPCFunc, CHAIN_GATE_EXTRA_WAIT_START_STATE);
        }
        break;
         
    case CX2UnitManager::NUI_CHAINGATE_POST:
        {
            SET_START_FUNC(         npcID, "CHAIN_GATE_POST_BROKEN",           CX2GUNPCFunc, CHAIN_GATE_POST_BROKEN_START_STATE);
        }
        break;

    case CX2UnitManager::NUI_CHAINGATE_POST_EXTRA:
        {
            SET_START_FUNC(         npcID, "CHAIN_GATE_POST_BROKEN",           CX2GUNPCFunc, CHAIN_GATE_POST_EXTRA_BROKEN_START_STATE);
        }
        break;

    case CX2UnitManager::NUI_MONKEY_BOSS:
    case CX2UnitManager::NUI_MONKEY_BOSS_EASY:
        {
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOSS_WAIT2",                CX2GUNPCFunc, MONKEY_BOSS_WAIT2_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOSS_WAIT3",                CX2GUNPCFunc, MONKEY_BOSS_WAIT3_FRAME_MOVE);
            SET_END_FUNC(           npcID, "MONKEY_BOSS_WALK",                 CX2GUNPCFunc, MONKEY_BOSS_WALK_STATE_END);
            SET_END_FUNC(           npcID, "MONKEY_BOSS_JUMP_DOWN",            CX2GUNPCFunc, MONKEY_BOSS_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "MONKEY_BOSS_JUMP_DOWN_DIR",        CX2GUNPCFunc, MONKEY_BOSS_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOSS_PUNCH_PUNCH_ATTACK",   CX2GUNPCFunc, MONKEY_BOSS_PUNCH_PUNCH_ATTACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOSS_DAMAGE_SMALL",         CX2GUNPCFunc, MONKEY_BOSS_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOSS_DAMAGE_BIG",           CX2GUNPCFunc, MONKEY_BOSS_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOSS_DAMAGE_DOWN_FRONT",    CX2GUNPCFunc, MONKEY_BOSS_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOSS_DAMAGE_DOWN_BACK",     CX2GUNPCFunc, MONKEY_BOSS_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOSS_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MONKEY_BOSS_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOSS_STAND_UP_ATTACK_FRONT", CX2GUNPCFunc, MONKEY_BOSS_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_BOSS_STAND_UP_ATTACK_BACK", CX2GUNPCFunc, MONKEY_BOSS_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "MONKEY_BOSS_DYING_LAND_FRONT",     CX2GUNPCFunc, MONKEY_BOSS_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_BOSS_DYING_LAND_BACK",      CX2GUNPCFunc, MONKEY_BOSS_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MONKEY_BOSS_DYING_SKY",            CX2GUNPCFunc, MONKEY_BOSS_DYING_LAND_STATE_START);
        }
        break;

	case CX2UnitManager::NUI_MONKEY_ROLLING:
		{
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_ROLLING_WAIT2",                CX2GUNPCFunc, MONKEY_BOSS_WAIT2_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_ROLLING_WAIT3",                CX2GUNPCFunc, MONKEY_BOSS_WAIT3_FRAME_MOVE);
			SET_END_FUNC(           npcID, "MONKEY_ROLLING_WALK",                 CX2GUNPCFunc, MONKEY_BOSS_WALK_STATE_END);
			SET_END_FUNC(           npcID, "MONKEY_ROLLING_JUMP_DOWN",            CX2GUNPCFunc, MONKEY_BOSS_JUMP_DOWN_STATE_END);
			SET_END_FUNC(           npcID, "MONKEY_ROLLING_JUMP_DOWN_DIR",        CX2GUNPCFunc, MONKEY_BOSS_JUMP_DOWN_DIR_STATE_END);
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_ROLLING_PUNCH_PUNCH_ATTACK",   CX2GUNPCFunc, MONKEY_BOSS_PUNCH_PUNCH_ATTACK_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_ROLLING_DAMAGE_SMALL",         CX2GUNPCFunc, MONKEY_BOSS_DAMAGE_SMALL_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_ROLLING_DAMAGE_BIG",           CX2GUNPCFunc, MONKEY_BOSS_DAMAGE_BIG_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_ROLLING_DAMAGE_DOWN_FRONT",    CX2GUNPCFunc, MONKEY_BOSS_DAMAGE_DOWN_FRONT_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_ROLLING_DAMAGE_DOWN_BACK",     CX2GUNPCFunc, MONKEY_BOSS_DAMAGE_DOWN_BACK_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_ROLLING_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MONKEY_BOSS_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_ROLLING_STAND_UP_ATTACK_FRONT", CX2GUNPCFunc, MONKEY_BOSS_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MONKEY_ROLLING_STAND_UP_ATTACK_BACK", CX2GUNPCFunc, MONKEY_BOSS_STAND_UP_ATTACK_BACK_FRAME_MOVE);
			SET_START_FUNC(         npcID, "MONKEY_ROLLING_DYING_LAND_FRONT",     CX2GUNPCFunc, MONKEY_BOSS_DYING_LAND_STATE_START);
			SET_START_FUNC(         npcID, "MONKEY_ROLLING_DYING_LAND_BACK",      CX2GUNPCFunc, MONKEY_BOSS_DYING_LAND_STATE_START);
			SET_START_FUNC(         npcID, "MONKEY_ROLLING_DYING_SKY",            CX2GUNPCFunc, MONKEY_BOSS_DYING_LAND_STATE_START);
		} break;

    case CX2UnitManager::NUI_MUSHROOM:
        {
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_WALK",                    CX2GUNPCFunc, MUSHROOM_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "MUSHROOM_WALK",                    CX2GUNPCFunc, MUSHROOM_WALK_STATE_END);
            SET_END_FUNC(           npcID, "MUSHROOM_JUMP_DOWN",               CX2GUNPCFunc, MUSHROOM_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "MUSHROOM_JUMP_DOWN_DIR",           CX2GUNPCFunc, MUSHROOM_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_DAMAGE",                  CX2GUNPCFunc, MUSHROOM_DAMAGE_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_DAMAGE_DOWN_FRONT",       CX2GUNPCFunc, MUSHROOM_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_DAMAGE_DOWN_BACK",        CX2GUNPCFunc, MUSHROOM_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MUSHROOM_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_START_FUNC(         npcID, "MUSHROOM_DYING_LAND_FRONT",        CX2GUNPCFunc, MUSHROOM_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MUSHROOM_DYING_LAND_BACK",         CX2GUNPCFunc, MUSHROOM_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MUSHROOM_DYING_SKY",               CX2GUNPCFunc, MUSHROOM_DYING_LAND_STATE_START);
        }
        break;
//{{ oasis907 :  [2010.10.21] //  
	case CX2UnitManager::NUI_HALLOWEEN_MUSHROOM:
		{
			SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_WALK",                    CX2GUNPCFunc, MUSHROOM_WALK_FRAME_MOVE);
			SET_END_FUNC(           npcID, "MUSHROOM_WALK",                    CX2GUNPCFunc, MUSHROOM_WALK_STATE_END);
			SET_END_FUNC(           npcID, "MUSHROOM_JUMP_DOWN",               CX2GUNPCFunc, MUSHROOM_JUMP_DOWN_STATE_END);
			SET_END_FUNC(           npcID, "MUSHROOM_JUMP_DOWN_DIR",           CX2GUNPCFunc, MUSHROOM_JUMP_DOWN_DIR_STATE_END);
			SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_DAMAGE",                  CX2GUNPCFunc, MUSHROOM_DAMAGE_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_DAMAGE_DOWN_FRONT",       CX2GUNPCFunc, MUSHROOM_DAMAGE_DOWN_FRONT_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_DAMAGE_DOWN_BACK",        CX2GUNPCFunc, MUSHROOM_DAMAGE_DOWN_BACK_FRAME_MOVE);
			SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MUSHROOM_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
			SET_START_FUNC(         npcID, "MUSHROOM_DYING_LAND_FRONT",        CX2GUNPCFunc, MUSHROOM_DYING_LAND_STATE_START);
			SET_START_FUNC(         npcID, "MUSHROOM_DYING_LAND_BACK",         CX2GUNPCFunc, MUSHROOM_DYING_LAND_STATE_START);
			SET_START_FUNC(         npcID, "MUSHROOM_DYING_SKY",               CX2GUNPCFunc, MUSHROOM_DYING_LAND_STATE_START);
		}
		break;
//}} oasis907 :  [2010.10.21] // 
    case CX2UnitManager::NUI_MUSHROOM_EASY:
        {
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_EASY_WALK",                    CX2GUNPCFunc, MUSHROOM_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "MUSHROOM_EASY_WALK",                    CX2GUNPCFunc, MUSHROOM_WALK_STATE_END);
            SET_END_FUNC(           npcID, "MUSHROOM_EASY_JUMP_DOWN",               CX2GUNPCFunc, MUSHROOM_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "MUSHROOM_EASY_JUMP_DOWN_DIR",           CX2GUNPCFunc, MUSHROOM_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_EASY_DAMAGE",                  CX2GUNPCFunc, MUSHROOM_DAMAGE_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_EASY_DAMAGE_DOWN_FRONT",       CX2GUNPCFunc, MUSHROOM_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_EASY_DAMAGE_DOWN_BACK",        CX2GUNPCFunc, MUSHROOM_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_EASY_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MUSHROOM_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_START_FUNC(         npcID, "MUSHROOM_EASY_DYING_LAND_FRONT",        CX2GUNPCFunc, MUSHROOM_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MUSHROOM_EASY_DYING_LAND_BACK",         CX2GUNPCFunc, MUSHROOM_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MUSHROOM_EASY_DYING_SKY",               CX2GUNPCFunc, MUSHROOM_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_MUSHROOM_WOODEN:
        {
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_WOODEN_WALK",             CX2GUNPCFunc, MUSHROOM_WOODEN_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "MUSHROOM_WOODEN_WALK",             CX2GUNPCFunc, MUSHROOM_WOODEN_WALK_STATE_END);
            SET_END_FUNC(           npcID, "MUSHROOM_WOODEN_JUMP_DOWN",        CX2GUNPCFunc, MUSHROOM_WOODEN_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "MUSHROOM_WOODEN_JUMP_DOWN_DIR",    CX2GUNPCFunc, MUSHROOM_WOODEN_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_WOODEN_DAMAGE",           CX2GUNPCFunc, MUSHROOM_WOODEN_DAMAGE_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_WOODEN_DAMAGE_DOWN_FRONT",CX2GUNPCFunc, MUSHROOM_WOODEN_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_WOODEN_DAMAGE_DOWN_BACK", CX2GUNPCFunc, MUSHROOM_WOODEN_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "MUSHROOM_WOODEN_DAMAGE_AIR_DOWN_LANDING", CX2GUNPCFunc, MUSHROOM_WOODEN_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_START_FUNC(         npcID, "MUSHROOM_WOODEN_DYING_LAND_FRONT", CX2GUNPCFunc, MUSHROOM_WOODEN_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MUSHROOM_WOODEN_DYING_LAND_BACK",  CX2GUNPCFunc, MUSHROOM_WOODEN_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "MUSHROOM_WOODEN_DYING_SKY",        CX2GUNPCFunc, MUSHROOM_WOODEN_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_PPORU_WILLIAM_NORMAL:
        {
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_WAIT",               CX2GUNPCFunc, WILLIAM_PPORU_WAIT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_WALK",               CX2GUNPCFunc, WILLIAM_PPORU_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "WILLIAM_PPORU_WALK",               CX2GUNPCFunc, WILLIAM_PPORU_WALK_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DASH",               CX2GUNPCFunc, WILLIAM_PPORU_DASH_FRAME_MOVE);
            SET_START_FUNC(         npcID, "WILLIAM_PPORU_DASH_END",           CX2GUNPCFunc, WILLIAM_PPORU_DASH_END_STATE_START);
            SET_END_FUNC(           npcID, "WILLIAM_PPORU_JUMP_DOWN",          CX2GUNPCFunc, WILLIAM_PPORU_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "WILLIAM_PPORU_JUMP_DOWN_DIR",      CX2GUNPCFunc, WILLIAM_PPORU_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_COMBO_ATTACK_A",     CX2GUNPCFunc, WILLIAM_PPORU_COMBO_ATTACK_A_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DAMAGE_SMALL",       CX2GUNPCFunc, WILLIAM_PPORU_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DAMAGE_BIG",         CX2GUNPCFunc, WILLIAM_PPORU_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DAMAGE_DOWN_FRONT",  CX2GUNPCFunc, WILLIAM_PPORU_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DAMAGE_DOWN_BACK",   CX2GUNPCFunc, WILLIAM_PPORU_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DAMAGE_AIR_DOWN_LANDING",CX2GUNPCFunc, WILLIAM_PPORU_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_STAND_UP_ATTACK_FRONT",  CX2GUNPCFunc, WILLIAM_PPORU_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_STAND_UP_ATTACK_BACK",   CX2GUNPCFunc, WILLIAM_PPORU_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "WILLIAM_PPORU_DYING_LAND_FRONT",   CX2GUNPCFunc, WILLIAM_PPORU_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "WILLIAM_PPORU_DYING_LAND_BACK",    CX2GUNPCFunc, WILLIAM_PPORU_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "WILLIAM_PPORU_DYING_SKY",          CX2GUNPCFunc, WILLIAM_PPORU_DYING_LAND_STATE_START);
        }
        break;

    case CX2UnitManager::NUI_PPORU_WILLIAM_HARD:
        {
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_WAIT",               CX2GUNPCFunc, WILLIAM_PPORU_HARD_WAIT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_WALK",               CX2GUNPCFunc, WILLIAM_PPORU_HARD_WALK_FRAME_MOVE);
            SET_END_FUNC(           npcID, "WILLIAM_PPORU_WALK",               CX2GUNPCFunc, WILLIAM_PPORU_HARD_WALK_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DASH",               CX2GUNPCFunc, WILLIAM_PPORU_HARD_DASH_FRAME_MOVE);
            SET_START_FUNC(         npcID, "WILLIAM_PPORU_DASH_END",           CX2GUNPCFunc, WILLIAM_PPORU_HARD_DASH_END_STATE_START);
            SET_END_FUNC(           npcID, "WILLIAM_PPORU_JUMP_DOWN",          CX2GUNPCFunc, WILLIAM_PPORU_HARD_JUMP_DOWN_STATE_END);
            SET_END_FUNC(           npcID, "WILLIAM_PPORU_JUMP_DOWN_DIR",      CX2GUNPCFunc, WILLIAM_PPORU_HARD_JUMP_DOWN_DIR_STATE_END);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_ATTACK",             CX2GUNPCFunc, WILLIAM_PPORU_HARD_ATTACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_COMBO_ATTACK_A",     CX2GUNPCFunc, WILLIAM_PPORU_HARD_COMBO_ATTACK_A_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DAMAGE_SMALL",       CX2GUNPCFunc, WILLIAM_PPORU_HARD_DAMAGE_SMALL_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DAMAGE_BIG",         CX2GUNPCFunc, WILLIAM_PPORU_HARD_DAMAGE_BIG_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DAMAGE_DOWN_FRONT",  CX2GUNPCFunc, WILLIAM_PPORU_HARD_DAMAGE_DOWN_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DAMAGE_DOWN_BACK",   CX2GUNPCFunc, WILLIAM_PPORU_HARD_DAMAGE_DOWN_BACK_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_DAMAGE_AIR_DOWN_LANDING",CX2GUNPCFunc, WILLIAM_PPORU_HARD_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_STAND_UP_ATTACK_FRONT",  CX2GUNPCFunc, WILLIAM_PPORU_HARD_STAND_UP_ATTACK_FRONT_FRAME_MOVE);
            SET_FRAME_MOVE_FUNC(    npcID, "WILLIAM_PPORU_STAND_UP_ATTACK_BACK",   CX2GUNPCFunc, WILLIAM_PPORU_HARD_STAND_UP_ATTACK_BACK_FRAME_MOVE);
            SET_START_FUNC(         npcID, "WILLIAM_PPORU_DYING_LAND_FRONT",   CX2GUNPCFunc, WILLIAM_PPORU_HARD_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "WILLIAM_PPORU_DYING_LAND_BACK",    CX2GUNPCFunc, WILLIAM_PPORU_HARD_DYING_LAND_STATE_START);
            SET_START_FUNC(         npcID, "WILLIAM_PPORU_DYING_SKY",          CX2GUNPCFunc, WILLIAM_PPORU_HARD_DYING_LAND_STATE_START);
        }
        break;
        
	case CX2UnitManager::NUI_PPORU_GIANT_RED:
		{
			SET_FRAME_MOVE_FUNC(	npcID, "GIANT_PPORU_RED_SPECIAL_ATTACK_A",	CX2GUNPCFunc, GIANT_PPORU_RED_SPECIAL_ATTACK_A_FRAME_MOVE );
		}
		break;

	case CX2UnitManager::NUI_PPORU_GIANT_BLACK:
		{
			SET_FRAME_MOVE_FUNC(	npcID, "GIANT_PPORU_BLACK_SPECIAL_ATTACK_A",	CX2GUNPCFunc, GIANT_PPORU_RED_SPECIAL_ATTACK_A_FRAME_MOVE );
		}
		break;

	case CX2UnitManager::NUI_PPORU_GIANT_WHITE:
		{
			SET_FRAME_MOVE_FUNC(	npcID, "GIANT_PPORU_WHITE_SPECIAL_ATTACK_A",	CX2GUNPCFunc, GIANT_PPORU_RED_SPECIAL_ATTACK_A_FRAME_MOVE );
		}
		break;

	case CX2UnitManager::NUI_BARRIERMACHINE_FIRE:
		{
			SET_COMMON_FRAME_MOVE_FUNC(	npcID, CX2GUNPCFunc, BARRIER_CREATEMACHINE_FIRE_COMMON_FRAME_MOVE );
		} 
		break;

	case CX2UnitManager::NUI_BARRIERMACHINE_ICE:
		{
			SET_COMMON_FRAME_MOVE_FUNC(	npcID, CX2GUNPCFunc, BARRIER_CREATEMACHINE_ICE_COMMON_FRAME_MOVE );
		} 
		break;


	case CX2UnitManager::NUI_NASOD_ELEMENT_FIRE:
		{
			SET_COMMON_FRAME_MOVE_FUNC(	npcID, CX2GUNPCFunc, NASOD_ELEMENT_FIRE_COMMON_FRAME_MOVE );
		} 
		break;

	case CX2UnitManager::NUI_NASOD_ELEMENT_ICE:
		{
			SET_COMMON_FRAME_MOVE_FUNC(	npcID, CX2GUNPCFunc, NASOD_ELEMENT_ICE_COMMON_FRAME_MOVE );
		} 
		break;

	case CX2UnitManager::NUI_BAT_A:
		{
			SET_START_FUNC(				npcID, "BAT_A_FLY",	CX2GUNPCFunc, BAT_A_FLY_STATE_START );
			SET_FRAME_MOVE_FUNC(		npcID, "BAT_A_FLY",	CX2GUNPCFunc, BAT_A_FLY_FRAME_MOVE );
		}
		break;
		 
	default:
		break;
	}
}

void CX2GUNPCFunc::SetStartFunc( CX2UnitManager::NPC_UNIT_ID npcID, int stateID, NPCFunc npcFunc )
{
	KTDXPROFILE();

	std::pair<CX2UnitManager::NPC_UNIT_ID,int> key = std::make_pair( npcID, stateID );
	if( m_StartFuncMap.find( key ) == m_StartFuncMap.end() )
	{
		m_StartFuncMap.insert( std::make_pair(key, npcFunc) );
	}
}

void CX2GUNPCFunc::SetFrameMoveFunc( CX2UnitManager::NPC_UNIT_ID npcID, int stateID, NPCFunc npcFunc )
{
	KTDXPROFILE();

	std::pair<CX2UnitManager::NPC_UNIT_ID,int> key = std::make_pair( npcID, stateID );
	if( m_FrameMoveFuncMap.find( key ) == m_FrameMoveFuncMap.end() )
	{
		m_FrameMoveFuncMap.insert( std::make_pair(key, npcFunc) );
	}
}

void CX2GUNPCFunc::SetEndFunc( CX2UnitManager::NPC_UNIT_ID npcID, int stateID, NPCFunc npcFunc )
{
	KTDXPROFILE();

	std::pair<CX2UnitManager::NPC_UNIT_ID,int> key = std::make_pair( npcID, stateID );
	if( m_EndFuncMap.find( key ) == m_EndFuncMap.end() )
	{
		m_EndFuncMap.insert( std::make_pair(key, npcFunc) );
	}
}


void CX2GUNPCFunc::SetCommonFrameMoveFunc( CX2UnitManager::NPC_UNIT_ID npcID, NPCFunc npcFunc )
{
	KTDXPROFILE();

	if( m_CommonFrameMoveFuncMap.find( npcID ) == m_CommonFrameMoveFuncMap.end() )
	{
		m_CommonFrameMoveFuncMap.insert( std::make_pair(npcID, npcFunc) );
	}
}

void CX2GUNPCFunc::StartFunc( CX2GUNPC* pNPC )
{
	KTDXPROFILE();

	if( pNPC == NULL )
		return;

	std::pair<CX2UnitManager::NPC_UNIT_ID,int> key = std::make_pair( pNPC->GetNPCTemplet().m_nNPCUnitID, pNPC->GetNPCFrameData().syncData.nowState );
	map< std::pair<CX2UnitManager::NPC_UNIT_ID, int>, NPCFunc >::iterator iter;
	iter = m_StartFuncMap.find( key );
	if( iter != m_StartFuncMap.end() )
	{
		NPCFunc func = iter->second;
		func( pNPC );
	}
}

void CX2GUNPCFunc::FrameMoveFunc( CX2GUNPC* pNPC )
{
	KTDXPROFILE();

	if( pNPC == NULL )
		return;

	std::pair<CX2UnitManager::NPC_UNIT_ID,int> key = std::make_pair( pNPC->GetNPCTemplet().m_nNPCUnitID, pNPC->GetNPCFrameData().syncData.nowState );
	map< std::pair<CX2UnitManager::NPC_UNIT_ID, int>, NPCFunc >::iterator iter;
	iter = m_FrameMoveFuncMap.find( key );
	if( iter != m_FrameMoveFuncMap.end() )
	{
		NPCFunc func = iter->second;
		func( pNPC );
	}
}

void CX2GUNPCFunc::EndFunc( CX2GUNPC* pNPC )
{
	KTDXPROFILE();

	if( pNPC == NULL )
		return;

	std::pair<CX2UnitManager::NPC_UNIT_ID,int> key = std::make_pair( pNPC->GetNPCTemplet().m_nNPCUnitID, pNPC->GetNPCFrameData().syncData.nowState );
	map< std::pair<CX2UnitManager::NPC_UNIT_ID, int>, NPCFunc >::iterator iter;
	iter = m_EndFuncMap.find( key );
	if( iter != m_EndFuncMap.end() )
	{
		NPCFunc func = iter->second;
		func( pNPC );
	}
}

void CX2GUNPCFunc::CommonFrameMoveFunc( CX2GUNPC* pNPC )
{
	KTDXPROFILE();

	if( pNPC == NULL )
		return;

	map< CX2UnitManager::NPC_UNIT_ID, NPCFunc >::iterator iter;
	iter = m_CommonFrameMoveFuncMap.find( pNPC->GetNPCTemplet().m_nNPCUnitID );
	if( iter != m_CommonFrameMoveFuncMap.end() )
	{
		NPCFunc func = iter->second;
		func( pNPC );
	}
}


// bee.lua
void CX2GUNPCFunc::BEE_FLY_STATE_START( CX2GUNPC* pNPCUnit )
{


	MONSTER_FLY_START_AT_HAVE_TARGET( pNPCUnit, 1.0f, 2.0f );
}

void CX2GUNPCFunc::BEE_FLY_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	MONSTER_FLY_FRAME_MOVE( pNPCUnit );
}	

void CX2GUNPCFunc::BEE_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
	g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::BEE_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
	g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::BEE_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	if( pNPCUnit->AnimEventTimer_LUA( 0.047f ) )
	{
		g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
	}
}

void CX2GUNPCFunc::BEE_DAMAGE_DOWN_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	if( pNPCUnit->AnimEventTimer_LUA( 0.25f ) )
	{
		pNPCUnit->PlaySound_LUA( "Down.ogg" );
		g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
	}
}

void CX2GUNPCFunc::BEE_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
	{
		pNPCUnit->PlaySound_LUA( "Down.ogg" );		
		D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
		g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
		pos.y = pos.y + 5;
		g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
		CKTDGParticleSystem::CParticleEventSequence* pParticle = g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
		if( NULL != pParticle )
		{
			pParticle->SetLandPosition( pos.y - 5 );
		}

		if( GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500 )
		{
			g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
		}
	}
	else if( pNPCUnit->AnimEventTimer_LUA( 0.35f ) )
	{
		pNPCUnit->PlaySound_LUA( "Down.ogg" );
		
		g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
	}
}

void CX2GUNPCFunc::BEE_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
	D3DXVECTOR3 pos = pNPCUnit->GetPos();
	pos.y = pos.y + 100.0f;		
	//g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "DieImpactRingRed",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
	//g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "DieImpactSlashRed",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
	//g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "DieSmoke",				pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(5,-1) );

	CKTDGParticleSystem::CParticleEventSequence* pSeq = g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
	if( pSeq != NULL )
	{
		pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
		pNPCUnit->SetDieSeq( pSeq->GetHandle() );
	}

	pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// Bee_NoDrop.lua
void CX2GUNPCFunc::BEE_NODROP_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit,"StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1));
}

void CX2GUNPCFunc::BEE_NODROP_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1));

}

void CX2GUNPCFunc::BEE_NODROP_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA(0.047f))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::BEE_NODROP_DAMAGE_DOWN_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.25f ))
    {
        pNPCUnit->PlaySound_LUA("Down.ogg");
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}

void CX2GUNPCFunc::BEE_NODROP_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle == NULL)
            return;

        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();

        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
        pos.y = pos.y + 5;
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
        CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
        if(pParticle == NULL)
            return;

        pParticle->SetLandPosition( pos.y - 5 );
        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.35f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}

void CX2GUNPCFunc::BEE_NODROP_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight", pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// BeeBomb.lua
void CX2GUNPCFunc::BEE_BOMB_ANGRY_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    pNPCUnit->SetUseWorldColor( false );
    D3DXCOLOR color = pNPCUnit->GetColor();
#ifdef  X2OPTIMIZE_NPC_ADAPTIVE_FRAME_MOVE
    color.g = color.g - (1 * pNPCUnit->GetElapsedTime());
    color.b = color.g - (1 * pNPCUnit->GetElapsedTime());
#else   X2OPTIMIZE_NPC_ADAPTIVE_FRAME_MOVE
    color.g = color.g - (1 * g_pKTDXApp->GetElapsedTime());
    color.b = color.g - (1 * g_pKTDXApp->GetElapsedTime());
#endif  X2OPTIMIZE_NPC_ADAPTIVE_FRAME_MOVE
    pNPCUnit->SetColor( color );

    pNPCUnit->SetFlag_LUA( 0, true );
}

void CX2GUNPCFunc::BEE_BOMB_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::BEE_BOMB_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::BEE_BOMB_BOMB_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
}

void CX2GUNPCFunc::BEE_BOMB_BOMB_EXPLODE_STATE_START( CX2GUNPC* pNPCUnit )
{
    if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
    {
        g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 20.0f, 0.3f );
    }

    CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
    if(pMajorParticle == NULL)
        return;
    pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ExplodeImpactRingRed",		pNPCUnit->GetImpactPoint_LUA(), D3DXVECTOR2(-1,-1), D3DXVECTOR2(4,-1) );
    pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ExplodeImpactSlashRed",	pNPCUnit->GetImpactPoint_LUA(), D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ExplodeSmoke",				pNPCUnit->GetImpactPoint_LUA(), D3DXVECTOR2(-1,-1), D3DXVECTOR2(20,-1) );
    CKTDGParticleSystem::CParticleEventSequence *pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ExplodeTail",	pNPCUnit->GetImpactPoint_LUA(), D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if(pParticle != NULL)
        pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
}

void CX2GUNPCFunc::BEE_BOMB_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::BEE_BOMB_DAMAGE_DOWN_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.25f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}

void CX2GUNPCFunc::BEE_BOMB_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle == NULL)        
            return;
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
        pos.y = pos.y + 5;
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
        CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
        if(pParticle != NULL)
            pParticle->SetLandPosition( pos.y - 5 );

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }
    }
    else if( pNPCUnit->AnimEventTimer_LUA( 0.35f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}

void CX2GUNPCFunc::BEE_BOMB_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}


// BeeBomb.lua
void CX2GUNPCFunc::BEE_BOMB_NODROP_ANGRY_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    pNPCUnit->SetUseWorldColor( false );
    D3DXCOLOR color = pNPCUnit->GetColor();
#ifdef  X2OPTIMIZE_NPC_ADAPTIVE_FRAME_MOVE
    color.g = color.g - (1 * pNPCUnit->GetElapsedTime());
    color.b = color.g - (1 * pNPCUnit->GetElapsedTime());
#else   X2OPTIMIZE_NPC_ADAPTIVE_FRAME_MOVE
    color.g = color.g - (1 * g_pKTDXApp->GetElapsedTime());
    color.b = color.g - (1 * g_pKTDXApp->GetElapsedTime());
#endif  X2OPTIMIZE_NPC_ADAPTIVE_FRAME_MOVE
    pNPCUnit->SetColor( color );

    pNPCUnit->SetFlag_LUA( 0, true );
}

void CX2GUNPCFunc::BEE_BOMB_NODROP_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::BEE_BOMB_NODROP_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::BEE_BOMB_NODROP_BOMB_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
}

void CX2GUNPCFunc::BEE_BOMB_NODROP_BOMB_EXPLODE_STATE_START( CX2GUNPC* pNPCUnit )
{
    if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
    {
        g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 20.0f, 0.3f );
    }

    CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
    if(pMajorParticle == NULL)
        return;
    pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ExplodeImpactRingRed",		pNPCUnit->GetImpactPoint_LUA(), D3DXVECTOR2(-1,-1), D3DXVECTOR2(4,-1) );
    pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ExplodeImpactSlashRed",	pNPCUnit->GetImpactPoint_LUA(), D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ExplodeSmoke",				pNPCUnit->GetImpactPoint_LUA(), D3DXVECTOR2(-1,-1), D3DXVECTOR2(20,-1) );
    CKTDGParticleSystem::CParticleEventSequence *pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ExplodeTail",	pNPCUnit->GetImpactPoint_LUA(), D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if(pParticle)
        pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
}

void CX2GUNPCFunc::BEE_BOMB_NODROP_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::BEE_BOMB_NODROP_DAMAGE_DOWN_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.25 ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}

void CX2GUNPCFunc::BEE_BOMB_NODROP_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle == NULL)        
            return;
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
        pos.y = pos.y + 5;
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
        CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
        if(pParticle != NULL)
            pParticle->SetLandPosition( pos.y - 5 );

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }
    }
    else if( pNPCUnit->AnimEventTimer_LUA( 0.35f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}

void CX2GUNPCFunc::BEE_BOMB_NODROP_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// BeePoison.lua
void CX2GUNPCFunc::BEE_POISON_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}

void CX2GUNPCFunc::BEE_POISON_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::BEE_POISON_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::BEE_POISON_DAMAGE_DOWN_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.25f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}

void CX2GUNPCFunc::BEE_POISON_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle == NULL)        
            return;
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
        pos.y = pos.y + 5;
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
        CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
        if(pParticle != NULL)
            pParticle->SetLandPosition( pos.y - 5 );

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }
    }
    else if( pNPCUnit->AnimEventTimer_LUA( 0.35f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}

void CX2GUNPCFunc::BEE_POISON_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// BeeAssault.lua
void CX2GUNPCFunc::BEE_ASSAULT_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::BEE_ASSAULT_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );    
}

void CX2GUNPCFunc::BEE_ASSAULT_BOMB_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
}

void CX2GUNPCFunc::BEE_ASSAULT_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::BEE_ASSAULT_DAMAGE_DOWN_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.25 ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}

void CX2GUNPCFunc::BEE_ASSAULT_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle == NULL)        
            return;
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
        pos.y = pos.y + 5;
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
        CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
        if(pParticle != NULL)
            pParticle->SetLandPosition( pos.y - 5 );

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }
    }
    else if( pNPCUnit->AnimEventTimer_LUA( 0.35f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}



void CX2GUNPCFunc::BEE_ASSAULT_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );    
}

// BeeHouse.lua
void CX2GUNPCFunc::BEE_HOUSE_START_STATE_START( CX2GUNPC* pNPCUnit )
{
    pNPCUnit->SetInt_LUA( 0, g_pX2Game->LiveNPCNumType_LUA( CX2UnitManager::NUI_BEE ) );    
}

void CX2GUNPCFunc::BEE_HOUSE_RESPAWN_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.8f ))
    {
        D3DXVECTOR3 pos = pNPCUnit->GetPos();
        pos.y = pos.y - 60;

        
        g_pX2Game->CreateNPCReq_LUA( CX2UnitManager::NUI_BEE_NODROP, pNPCUnit->GetHardLevel(), TRUE, pos, pNPCUnit->GetIsRight(), 0, true  );

        if(g_pX2Game->IsHost())
        {
#ifdef REFACTORING_BY_TOOL_TEAM
			pNPCUnit->UpNowHp( -500.f );
#else REFACTORING_BY_TOOL_TEAM
            float nowHP = pNPCUnit->GetNowHp();	
            pNPCUnit->SetNowHp( nowHP - 500.0f );
#endif REFACTORING_BY_TOOL_TEAM
        }
    }        
}

void CX2GUNPCFunc::BEE_HOUSE_DYING_STATE_START( CX2GUNPC* pNPCUnit )
{
    pNPCUnit->PlaySound_LUA( "Down.ogg" );
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)    
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
}


// BeeBombHouse.lua
void CX2GUNPCFunc::BEE_BOMB_HOUSE_START_STATE_START( CX2GUNPC* pNPCUnit )
{
    pNPCUnit->SetInt_LUA( 0, g_pX2Game->LiveNPCNumType_LUA( CX2UnitManager::NUI_BEEBOMB ) );   
}

void CX2GUNPCFunc::BEE_BOMB_HOUSE_RESPAWN_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.8f ))
    {
        D3DXVECTOR3 pos = pNPCUnit->GetPos();
        pos.y = pos.y - 60;

        g_pX2Game->CreateNPCReq_LUA( CX2UnitManager::NUI_BEEBOMB_NODROP, pNPCUnit->GetHardLevel(), TRUE, pos, pNPCUnit->GetIsRight(), 0, true  );

        if(g_pX2Game->IsHost())
        {
#ifdef REFACTORING_BY_TOOL_TEAM
			pNPCUnit->UpNowHp( -500.f );
#else REFACTORING_BY_TOOL_TEAM
            float nowHP = pNPCUnit->GetNowHp();	
            pNPCUnit->SetNowHp( nowHP - 500.0f );
#endif REFACTORING_BY_TOOL_TEAM


        }
    }       
}

void CX2GUNPCFunc::BEE_BOMB_HOUSE_DYING_STATE_START( CX2GUNPC* pNPCUnit )
{
    pNPCUnit->PlaySound_LUA( "Down.ogg" );
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)    
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
}

// BeePoisonHouse.lua
void CX2GUNPCFunc::BEE_POISON_HOUSE_START_STATE_START( CX2GUNPC* pNPCUnit )
{
    pNPCUnit->SetInt_LUA( 0, g_pX2Game->LiveNPCNumType_LUA( CX2UnitManager::NUI_BEEPOISON ) ); 
}

void CX2GUNPCFunc::BEE_POISON_HOUSE_RESPAWN_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.8f ))
    {
        D3DXVECTOR3 pos = pNPCUnit->GetPos();
        pos.y = pos.y - 60;

        g_pX2Game->CreateNPCReq_LUA( CX2UnitManager::NUI_BEEPOISON_NODROP, pNPCUnit->GetHardLevel(), TRUE, pos, pNPCUnit->GetIsRight(), 0, true  );

        if(g_pX2Game->IsHost())
        {
#ifdef REFACTORING_BY_TOOL_TEAM
			pNPCUnit->UpNowHp( -500.f );
#else REFACTORING_BY_TOOL_TEAM
            float nowHP = pNPCUnit->GetNowHp();	
            pNPCUnit->SetNowHp( nowHP - 500.0f );
#endif REFACTORING_BY_TOOL_TEAM


        }
    }       
}

void CX2GUNPCFunc::BEE_POISON_HOUSE_DYING_STATE_START( CX2GUNPC* pNPCUnit )
{
    pNPCUnit->PlaySound_LUA( "Down.ogg" );
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)    
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
}


// MonkeyA.lua
void CX2GUNPCFunc::MONKEY_A_WAIT2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) == true )
    {
        g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::MONKEY_A_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::MONKEY_A_WAIT3_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}
void CX2GUNPCFunc::MONKEY_A_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}

void CX2GUNPCFunc::MONKEY_A_FLY_READY_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	CX2GUUser* pGUUser = g_pX2Game->GetNearestUserUnitInSpecificRange( pNPCUnit->GetPos(), 0, 1000 );
	if ( pGUUser != NULL )
	{
		pNPCUnit->GetNPCAI()->SetAttackerGameUnit( pGUUser );
	}
}

void CX2GUNPCFunc::MONKEY_A_FLY_STATE_START( CX2GUNPC* pNPCUnit )
{
	MONSTER_FLY_START( pNPCUnit, 1.0f );
}

void CX2GUNPCFunc::MONKEY_A_FLY_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	MONSTER_FLY_FRAME_MOVE( pNPCUnit );
}

void CX2GUNPCFunc::MONKEY_A_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.06f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.3f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.2f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// MonkeyA_NoDrop.lua
void CX2GUNPCFunc::MONKEY_A_NODROP_WAIT2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) == true )
    {
        g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::MONKEY_A_NODROP_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::MONKEY_A_NODROP_WAIT3_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_NODROP_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}
void CX2GUNPCFunc::MONKEY_A_NODROP_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}
void CX2GUNPCFunc::MONKEY_A_NODROP_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_NODROP_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.06f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_NODROP_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.3f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_NODROP_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.2f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_NODROP_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_NODROP_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_NODROP_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_A_NODROP_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// MonkeyB.lua
void CX2GUNPCFunc::MONKEY_B_WAIT2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) == true )
    {
        g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::MONKEY_B_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::MONKEY_B_WAIT3_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MONKEY_B_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MONKEY_B_PUNCH_PUNCH_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{    
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {        
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }        

    if(pNPCUnit->AnimEventTimer_LUA( 0.9f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
    }

    if(pNPCUnit->AnimEventTimer_LUA( 0.9f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

    if(pNPCUnit->AnimEventTimer_LUA( 1.3f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
    }

    if(pNPCUnit->AnimEventTimer_LUA( 1.3f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

    if(pNPCUnit->AnimEventTimer_LUA( 2.0f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
        pNPCUnit->SetDamageData_LUA( "DAMAGE_DATA_LAST" );
    }

    if( pNPCUnit->AnimEventTimer_LUA( 2.0f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }
}
void CX2GUNPCFunc::MONKEY_B_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.06f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.3f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.2f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// MonkeyB_NoDrop.lua
void CX2GUNPCFunc::MONKEY_B_NODROP_WAIT2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) == true )
    {
        g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::MONKEY_B_NODROP_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::MONKEY_B_NODROP_WAIT3_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_NODROP_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}
void CX2GUNPCFunc::MONKEY_B_NODROP_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}
void CX2GUNPCFunc::MONKEY_B_NODROP_PUNCH_PUNCH_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{    
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {        
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

    if(pNPCUnit->AnimEventTimer_LUA( 0.9f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
    }

    if(pNPCUnit->AnimEventTimer_LUA( 0.9f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

    if(pNPCUnit->AnimEventTimer_LUA( 1.3f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
    }

    if(pNPCUnit->AnimEventTimer_LUA( 1.3f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

    if(pNPCUnit->AnimEventTimer_LUA( 2.0f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
        pNPCUnit->SetDamageData_LUA( "DAMAGE_DATA_LAST" );
    }

    if( pNPCUnit->AnimEventTimer_LUA( 2.0f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }
}
void CX2GUNPCFunc::MONKEY_B_NODROP_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_NODROP_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.06f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_NODROP_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.3f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_NODROP_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.2f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_NODROP_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_NODROP_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_NODROP_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_B_NODROP_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// MonkeyApple.lua
void CX2GUNPCFunc::MONKEY_APPLE_WAIT2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) == true )
    {
        g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::MONKEY_APPLE_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::MONKEY_APPLE_WAIT3_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}
void CX2GUNPCFunc::MONKEY_APPLE_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}
void CX2GUNPCFunc::MONKEY_APPLE_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.06f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.3f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.2f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}
void CX2GUNPCFunc::MONKEY_APPLE_APPLE_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.8f ))
    {
        CX2DamageEffect *pDamageEffect = g_pX2Game->GetDamageEffect();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pDamageEffect != NULL)
            pDamageEffect->CreateInstance_LUA( pNPCUnit, "APPLE", pNPCUnit->GetBonePos_LUA( "Dummy01_Rhand" ), pos.y );
    }
}

void CX2GUNPCFunc::MONKEY_APPLE_WAIT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
#ifdef RIDE_HORSE
	if ( pNPCUnit->GetRidingNPCUID() != 0 )
		return;

	if ( pNPCUnit->GetRiderNPCUID() != 0 )
		return;

	
	int npcUID = g_pX2Game->GetNearNPCUnitUIDEx( pNPCUnit->GetPos(), m_vecNpcIDForMonkeyApple, pNPCUnit->GetUID(), 200 );
	if ( npcUID == 0 )
	{
		
		return;
	}

	CX2GUNPC* pRidingNPC = g_pX2Game->GetNPCUnitByUID( npcUID );
	if ( pRidingNPC == NULL )
	{
		
		return;
	}

	if ( pRidingNPC->GetRiderNPCUID() != 0 || pRidingNPC->GetNowHp() <= 0 )
	{
		return;
	}

	pRidingNPC->SetRiderNPCUID( pNPCUnit->GetUID() );
	pNPCUnit->SetRidingNPCUID( pRidingNPC->GetUID() );

	pNPCUnit->StateChange( L"MONKEY_APPLE_RIDE_HORSE" );
#endif //RIDE_HORSE
}

void CX2GUNPCFunc::MONKEY_APPLE_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
#ifdef RIDE_HORSE

	if ( pNPCUnit->GetRidingNPCUID() != 0 )
		return;

	if ( pNPCUnit->GetRiderNPCUID() != 0 )
		return;




	int npcUID = g_pX2Game->GetNearNPCUnitUIDEx( pNPCUnit->GetPos(), m_vecNpcIDForMonkeyApple, pNPCUnit->GetUID(), 200 );
	if ( npcUID == 0 )
	{
		
		return;
	}

	CX2GUNPC* pRidingNPC = g_pX2Game->GetNPCUnitByUID( npcUID );
	if ( pRidingNPC == NULL )
	{
		
		return;
	}

	if ( pRidingNPC->GetRiderNPCUID() != 0 || pRidingNPC->GetNowHp() <= 0 )
	{
		
		return;
	}

	pRidingNPC->SetRiderNPCUID( pNPCUnit->GetUID() );
	pNPCUnit->SetRidingNPCUID( pRidingNPC->GetUID() );

	pNPCUnit->StateChange( L"MONKEY_APPLE_RIDE_HORSE" );

#endif //RIDE_HORSE
}

void CX2GUNPCFunc::MONKEY_APPLE_RIDE_HORSE_STATE_START( CX2GUNPC* pNPCUnit )
{
	/*
	int npcUID = g_pX2Game->GetNearNPCUnitUID_LUA( pNPCUnit->GetPos(), CX2UnitManager::NUI_HORSE );
	if ( npcUID == 0 )
	{
		pNPCUnit->StateChange( pNPCUnit->GetWaitStateID() );
		return;
	}

	CX2GUNPC* pRidingNPC = g_pX2Game->GetNPCUnitByUID( npcUID );
	if ( pRidingNPC == NULL )
	{
		pNPCUnit->StateChange( pNPCUnit->GetWaitStateID() );
		return;
	}

	if ( pRidingNPC->GetRiderNPCUID() != 0 || pRidingNPC->GetNowHp() <= 0 )
	{
		pNPCUnit->StateChange( pNPCUnit->GetWaitStateID() );
		return;
	}

	pRidingNPC->SetRiderNPCUID( pNPCUnit->GetUID() );
	pNPCUnit->SetRidingNPCUID( pRidingNPC->GetUID() );
	*/
}

void CX2GUNPCFunc::MONKEY_APPLE_RIDE_HORSE_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	if ( pNPCUnit->GetRidingNPCUID() == 0 )
		return;

	CX2GUNPC* pRidingNPC = g_pX2Game->GetNPCUnitByUID( pNPCUnit->GetRidingNPCUID() );
	if ( pRidingNPC != NULL )
	{
	

		if ( pRidingNPC->GetNowHp() <= 0 )
		{
			pRidingNPC->SetRiderNPCUID( 0 );
			pNPCUnit->SetRidingNPCUID( 0 );

			pNPCUnit->StateChange( "MONKEY_APPLE_LEAVE_HORSE" );
		}
	}
}

void CX2GUNPCFunc::MONKEY_APPLE_RIDE_APPLE_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	if ( pNPCUnit->GetRidingNPCUID() == 0 )
		return;

	CX2GUNPC* pRidingNPC = g_pX2Game->GetNPCUnitByUID( pNPCUnit->GetRidingNPCUID() );
	if ( pRidingNPC != NULL )
	{
		

		if ( pRidingNPC->GetNowHp() <= 0 )
		{
			pRidingNPC->SetRiderNPCUID( 0 );
			pNPCUnit->SetRidingNPCUID( 0 );

			pNPCUnit->StateChange( "MONKEY_APPLE_LEAVE_HORSE" );
		}
	}

	if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
	{
		CX2DamageEffect *pDamageEffect = g_pX2Game->GetDamageEffect();
		D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
		if(pDamageEffect != NULL)
		{
			D3DXVECTOR3 vRot = pNPCUnit->GetRotateDegree();
			vRot.z += 20;
			pDamageEffect->CreateInstance_LUA2( pNPCUnit, "APPLE", pNPCUnit->GetBonePos_LUA( "Dummy01_Rhand" ), pos.y, vRot );

			pDamageEffect->CreateInstance_LUA( pNPCUnit, "APPLE", pNPCUnit->GetBonePos_LUA( "Dummy01_Rhand" ), pos.y );
			vRot.z -= 40;
			pDamageEffect->CreateInstance_LUA2( pNPCUnit, "APPLE", pNPCUnit->GetBonePos_LUA( "Dummy01_Rhand" ), pos.y, vRot );
		}
	}
}

void CX2GUNPCFunc::MONKEY_APPLE_LEAVE_HORSE_STATE_END( CX2GUNPC* pNPCUnit )
{
	CX2GUNPC* pRidingNPC = g_pX2Game->GetNPCUnitByUID( pNPCUnit->GetRidingNPCUID() );
	if ( pRidingNPC != NULL )
	{
		pRidingNPC->SetRiderNPCUID( 0 );
	}

	
	pNPCUnit->SetRidingNPCUID( 0 );

	pNPCUnit->StateChange( pNPCUnit->GetWaitStateID() );
}


// MonkeyApple_NoDrop.lua
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_WAIT2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) == true )
    {
        g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}

void CX2GUNPCFunc::MONKEY_APPLE_NODROP_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}

void CX2GUNPCFunc::MONKEY_APPLE_NODROP_WAIT3_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.06f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.3f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.2f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}
void CX2GUNPCFunc::MONKEY_APPLE_NODROP_APPLE_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
    {
        CX2DamageEffect *pDamageEffect = g_pX2Game->GetDamageEffect();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pDamageEffect != NULL)
            pDamageEffect->CreateInstance_LUA( pNPCUnit, "APPLE", pNPCUnit->GetBonePos_LUA( "Dummy01_Rhand" ), pos.y );
    }
}


// MonkeyBomb.lua
void CX2GUNPCFunc::MONKEY_BOMB_SIEGE_WAIT_STATE_START( CX2GUNPC* pNPCUnit )
{
    pNPCUnit->SetShowGage( false );
}
void CX2GUNPCFunc::MONKEY_BOMB_SIEGE_BOMB_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
    {
        CX2DamageEffect *pDamageEffect = g_pX2Game->GetDamageEffect();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pDamageEffect != NULL)
            pDamageEffect->CreateInstance_LUA( pNPCUnit, "BOMB", pNPCUnit->GetBonePos_LUA( "Dummy01_Rhand" ), pos.y );	
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_WAIT_STATE_START( CX2GUNPC* pNPCUnit )
{
    pNPCUnit->SetShowGage( true );
}
void CX2GUNPCFunc::MONKEY_BOMB_WAIT2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.34f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_WAIT3_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MONKEY_BOMB_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MONKEY_BOMB_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MONKEY_BOMB_BOMB_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.8f ))
    {
        CX2DamageEffect *pDamageEffect = g_pX2Game->GetDamageEffect();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pDamageEffect != NULL)
            pDamageEffect->CreateInstance_LUA( pNPCUnit, "BOMB", pNPCUnit->GetBonePos_LUA( "Dummy01_Rhand" ), pos.y );
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.06f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.3f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.2f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 1.15f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOMB_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
    {
        CKTDGParticleSystem::CParticleEventSequence *pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",		pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
        if(pSeq != NULL)
        {
            pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
            pNPCUnit->SetDieSeq( pSeq->GetHandle() );
        }
    }
    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// SmallGate_Green.lua
void CX2GUNPCFunc::SMALL_GATE_GREEN_WAIT_START_STATE( CX2GUNPC* pNPCUnit )
{
    CKTDGXSkinAnim *pXSkinAnim = pNPCUnit->GetXSkinAnimPtr().get();
    if(pXSkinAnim != NULL)
        pXSkinAnim->SetUseTex( 2, false );
}


// SmallGate_Yellow.lua
void CX2GUNPCFunc::SMALL_GATE_YELLOW_WAIT_START_STATE( CX2GUNPC* pNPCUnit )
{
    CKTDGXSkinAnim *pXSkinAnim = pNPCUnit->GetXSkinAnimPtr().get();
    if(pXSkinAnim != NULL)
        pXSkinAnim->SetUseTex( 2, false );
}


// SmallGate_Red.lua
void CX2GUNPCFunc::SMALL_GATE_RED_WAIT_START_STATE( CX2GUNPC* pNPCUnit )
{
    CKTDGXSkinAnim *pXSkinAnim = pNPCUnit->GetXSkinAnimPtr().get();
    if(pXSkinAnim != NULL)
        pXSkinAnim->SetUseTex( 2, false );
}

// SmallGate_Post.lua
void CX2GUNPCFunc::SMALL_GATE_POST_BROKEN_START_STATE( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pParticle;
    float degreeY;

    if(pMinorParticle == NULL)
        return;

    pParticle= pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ChainGateLight1", pNPCUnit->GetBonePos_LUA( "COLLISION_SPHERE2" ), D3DXVECTOR2(1000,1000), D3DXVECTOR2(1,-1) );
    if(pParticle != NULL)
    {
        pNPCUnit->SetMinorParticle_LUA( 0, pParticle->GetHandle() );
        degreeY = pNPCUnit->GetXSkinAnimPtr()->GetMatrix().GetYRotateDegree() + 90.0f;
        pParticle->SetAddRotate( D3DXVECTOR3( 0.0f, degreeY, 0.0f ) );
    }    

    pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ChainGateLight2", pNPCUnit->GetBonePos_LUA( "COLLISION_SPHERE2" ), D3DXVECTOR2(1000,1000), D3DXVECTOR2(1,-1) );
    if(pParticle != NULL)
    {
        pNPCUnit->SetMinorParticle_LUA( 1, pParticle->GetHandle() );
        pParticle->SetAddRotate( D3DXVECTOR3( 0.0f, degreeY, 0.0f ) );
    }    
}

// Benders_Normal.lua
void CX2GUNPCFunc::BENDERS_WAIT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_DASH_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_COMBO2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
        pNPCUnit->ClearHitUnitList_LUA();
}
void CX2GUNPCFunc::BENDERS_SUMMON_MONSTER_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->SetWorldColor_LUA( D3DXCOLOR(0.2f, 0.2f, 0.2f, 1.0f) );
	CKTDGParticleSystem::CParticleEventSequence* pParticleSL = pNPCUnit->GetMinorParticle_LUA( 0 );
    if( pParticleSL != NULL )
        pParticleSL->SetPosition( pNPCUnit->GetBonePos_LUA("Bone05") );
        

    if( pNPCUnit->AnimEventTimer_LUA( 0.25f ) )
    {
        pNPCUnit->PlaySound_LUA( "Energy.ogg" );

        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyCenter",	bonePos, D3DXVECTOR2(20,40), D3DXVECTOR2(10,-1) );
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyLine",	bonePos, D3DXVECTOR2(40,80), D3DXVECTOR2(20,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetBlackHolePosition( bonePos );
                pParticle->UseLookPoint( true );
                pParticle->SetLookPoint( bonePos );
            }            

            CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
            if(pMajorParticle != NULL)
            {
                pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLightCenter",bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(-1,-1) );
                if( pParticle != NULL )
                {         
                    pNPCUnit->SetMinorParticle_LUA( 0, pParticle->GetHandle() );
                }
            }          
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 0.91f ) )
    {
        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_APPLE_NODROP, pNPCUnit->GetHardLevel(), false, pos, true, 1.9f, true, 0 );
            }           
        
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, false );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_A_NODROP, pNPCUnit->GetHardLevel(), false, pos, true, 2.0f, true, 0 );
            }

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );

				const D3DXVECTOR3& vPos = pNPCUnit->GetPos();
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPosition( &vPos, 500.0f, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_A_NODROP, pNPCUnit->GetHardLevel(), false, pos, false, 2.1f, true, 0 );
            }

            g_pX2Game->FlushCreateNPCReq();
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 2.0f ) )
    {
        CKTDGParticleSystem::CParticleEventSequence *pParticleSL2 = pNPCUnit->GetMinorParticle_LUA( 0 );
        if( pParticleSL2 != NULL )
        {
            pParticleSL2->SetAutoDie();
            pNPCUnit->ClearMinorParticle_LUA( 0 );
        }
    }
}
void CX2GUNPCFunc::BENDERS_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{    
    if( pNPCUnit->AnimEventTimer_LUA( 0.15f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.1f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.24f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            CKTDGParticleSystem::CParticleEventSequence *pParticle;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5.0f;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );            
            pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5.0f );
        }        

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500.0f)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }       	
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.80f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.72f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}


// Benders_Hard.lua
void CX2GUNPCFunc::BENDERS_HARD_WAIT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_HARD_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_HARD_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_HARD_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_HARD_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_HARD_DASH_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_HARD_COMBO2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
        pNPCUnit->ClearHitUnitList_LUA();
}
void CX2GUNPCFunc::BENDERS_HARD_SUMMON_MONSTER_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->SetWorldColor_LUA( D3DXCOLOR(0.2f, 0.2f, 0.2f, 1.0f) );

	CKTDGParticleSystem::CParticleEventSequence* pParticleSL = pNPCUnit->GetMinorParticle_LUA( 0 );
    if( pParticleSL != NULL )
        pParticleSL->SetPosition( pNPCUnit->GetBonePos_LUA("Bone05") );


    if( pNPCUnit->AnimEventTimer_LUA( 0.25f ) )
    {
        pNPCUnit->PlaySound_LUA( "Energy.ogg" );

        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyCenter",	bonePos, D3DXVECTOR2(20,40), D3DXVECTOR2(10,-1) );
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyLine",	bonePos, D3DXVECTOR2(40,80), D3DXVECTOR2(20,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetBlackHolePosition( bonePos );
                pParticle->UseLookPoint( true );
                pParticle->SetLookPoint( bonePos );
            }            

            CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
            if(pMajorParticle != NULL)
            {
                pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLightCenter",bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(-1,-1) );
                if( pParticle != NULL )
                {         
                    pNPCUnit->SetMinorParticle_LUA( 0, pParticle->GetHandle() );
                }
            }          
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 0.91f ) )
    {
        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_APPLE_NODROP, pNPCUnit->GetHardLevel(), false, pos, true, 1.9f, true, 0 );
            }           

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, false );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_B_NODROP, pNPCUnit->GetHardLevel(), false, pos, true, 2.0f, true, 0 );
            }

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );

				const D3DXVECTOR3& vPos = pNPCUnit->GetPos();
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPosition( &vPos, 500.0f, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_APPLE_NODROP, pNPCUnit->GetHardLevel(), false, pos, false, 2.1f, true, 0 );
            }

            g_pX2Game->FlushCreateNPCReq();
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 2.0f ) )
    {
		CKTDGParticleSystem::CParticleEventSequence *pParticleSL2 = pNPCUnit->GetMinorParticle_LUA( 0 );


        if( pParticleSL2 != NULL )
        {
            pParticleSL2->SetAutoDie();
            pNPCUnit->ClearMinorParticle_LUA( 0 );
        }
    }
}
void CX2GUNPCFunc::BENDERS_HARD_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{    
    if( pNPCUnit->AnimEventTimer_LUA( 0.15f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_HARD_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.1f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_HARD_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_HARD_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.24f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_HARD_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            CKTDGParticleSystem::CParticleEventSequence *pParticle;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5.0f;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );            
            pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5.0f );
        }        

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500.0f)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }       	
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_HARD_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.80f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_HARD_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.72f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_HARD_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// Benders_Expert.lua
void CX2GUNPCFunc::BENDERS_EXPERT_WAIT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
    if( fRemainHPRate < 0.7f )
    {
        pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
        pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_EXPERT_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_EXPERT_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_EXPERT_DASH_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_COMBO2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
        pNPCUnit->ClearHitUnitList_LUA();
}
void CX2GUNPCFunc::BENDERS_EXPERT_SUMMON_MONSTER_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->SetWorldColor_LUA( D3DXCOLOR(0.2f, 0.2f, 0.2f, 1.0f) );

	
	CKTDGParticleSystem::CParticleEventSequence* pParticleSL = pNPCUnit->GetMinorParticle_LUA( 0 );
    if( pParticleSL != NULL )
        pParticleSL->SetPosition( pNPCUnit->GetBonePos_LUA("Bone05") );


    if( pNPCUnit->AnimEventTimer_LUA( 0.25f ) )
    {
        pNPCUnit->PlaySound_LUA( "Energy.ogg" );

        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyCenter",	bonePos, D3DXVECTOR2(20,40), D3DXVECTOR2(10,-1) );
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyLine",	bonePos, D3DXVECTOR2(40,80), D3DXVECTOR2(20,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetBlackHolePosition( bonePos );
                pParticle->UseLookPoint( true );
                pParticle->SetLookPoint( bonePos );
            }            

            CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
            if(pMajorParticle != NULL)
            {
                pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLightCenter",bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(-1,-1) );
                if( pParticle != NULL )
                {         
                    pNPCUnit->SetMinorParticle_LUA( 0, pParticle->GetHandle() );
                }
            }          
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 0.91f ) )
    {
        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_APPLE_NODROP, pNPCUnit->GetHardLevel(), false, pos, true, 1.9f, true, 0 );
            }           

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, false );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_B_NODROP, pNPCUnit->GetHardLevel(), false, pos, true, 2.0f, true, 0 );
            }

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );

				const D3DXVECTOR3& vPos = pNPCUnit->GetPos();
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPosition( &vPos, 500.0f, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_APPLE_NODROP, pNPCUnit->GetHardLevel(), false, pos, false, 2.1f, true, 0 );
            }

            g_pX2Game->FlushCreateNPCReq();
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 2.0f ) )
    {
		CKTDGParticleSystem::CParticleEventSequence *pParticleSL2 = pNPCUnit->GetMinorParticle_LUA( 0 );

        if( pParticleSL2 != NULL )
        {
            pParticleSL2->SetAutoDie();
            pNPCUnit->ClearMinorParticle_LUA( 0 );
        }
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{    
    if( pNPCUnit->AnimEventTimer_LUA( 0.15f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.1f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_A_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.24f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            CKTDGParticleSystem::CParticleEventSequence *pParticle;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5.0f;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );            
            pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5.0f );
        }        

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500.0f)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }       	
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.80f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.72f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_EXPERT_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

// Benders_B.lua
void CX2GUNPCFunc::BENDERS_B_WAIT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
    if( fRemainHPRate < 0.7f )
    {
        pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_C_NODROP );
        pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_C_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_B_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_C_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_B_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_B_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_B_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_B_DASH_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_C_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_B_COMBO2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
        pNPCUnit->ClearHitUnitList_LUA();
}
void CX2GUNPCFunc::BENDERS_B_SUMMON_MONSTER_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->SetWorldColor_LUA( D3DXCOLOR(0.2f, 0.2f, 0.2f, 1.0f) );

	CKTDGParticleSystem::CParticleEventSequence* pParticleSL = pNPCUnit->GetMinorParticle_LUA( 0 );
    if( pParticleSL != NULL )
        pParticleSL->SetPosition( pNPCUnit->GetBonePos_LUA("Bone05") );


    if( pNPCUnit->AnimEventTimer_LUA( 0.25f ) )
    {
        pNPCUnit->PlaySound_LUA( "Energy.ogg" );

        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyCenter",	bonePos, D3DXVECTOR2(20,40), D3DXVECTOR2(10,-1) );
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyLine",	bonePos, D3DXVECTOR2(40,80), D3DXVECTOR2(20,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetBlackHolePosition( bonePos );
                pParticle->UseLookPoint( true );
                pParticle->SetLookPoint( bonePos );
            }            

            CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
            if(pMajorParticle != NULL)
            {
                pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLightCenter",bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(-1,-1) );
                if( pParticle != NULL )
                {         
                    pNPCUnit->SetMinorParticle_LUA( 0, pParticle->GetHandle() );
                }
            }          
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 0.91f ) )
    {
        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
				
				const D3DXVECTOR3& vPos = pNPCUnit->GetPos();
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &vPos, 500.0f, true, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_APPLE_NODROP, pNPCUnit->GetHardLevel(), false, pos, true, 1.9f, true, 0 );
            }           

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, false );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_C_NODROP, pNPCUnit->GetHardLevel(), false, pos, true, 2.0f, true, 0 );
            }

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );

				const D3DXVECTOR3& vPos = pNPCUnit->GetPos();
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPosition( &vPos, 500.0f, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_MONKEY_APPLE_NODROP, pNPCUnit->GetHardLevel(), false, pos, false, 2.1f, true, 0 );
            }

            g_pX2Game->FlushCreateNPCReq();
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 2.0f ) )
    {
		CKTDGParticleSystem::CParticleEventSequence *pParticleSL2 = pNPCUnit->GetMinorParticle_LUA( 0 );

        if( pParticleSL2 != NULL )
        {
            pParticleSL2->SetAutoDie();
            pNPCUnit->ClearMinorParticle_LUA( 0 );
        }
    }
}
void CX2GUNPCFunc::BENDERS_B_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{    
    if( pNPCUnit->AnimEventTimer_LUA( 0.15f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_C_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_B_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.1f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_C_NODROP );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MONKEY_APPLE_NODROP );
        }
    }
}
void CX2GUNPCFunc::BENDERS_B_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_B_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.24f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_B_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            CKTDGParticleSystem::CParticleEventSequence *pParticle;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5.0f;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );            
            pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5.0f );
        }        

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500.0f)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }       	
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_B_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.80f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_B_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.72f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_B_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}


// BendersUpgrade_Normal.lua
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_WAIT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_DASH_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_COMBO2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
        pNPCUnit->ClearHitUnitList_LUA();
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_COMBO_A_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );

    if( pNPCUnit->AnimEventTimer_LUA( 0.6f ) )
        pNPCUnit->ClearHitUnitList_LUA();

    if( pNPCUnit->AnimEventTimer_LUA( 0.6f ) )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );        

    if( pNPCUnit->AnimEventTimer_LUA( 1.6f ) )
        pNPCUnit->ClearHitUnitList_LUA();

    if( pNPCUnit->AnimEventTimer_LUA( 1.6f ) )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );

    if( pNPCUnit->AnimEventTimer_LUA( 1.6f ) )
        pNPCUnit->SetDamageData_LUA( "DAMAGE_DATA_LAST" );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_SUMMON_MONSTER_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->SetWorldColor_LUA( D3DXCOLOR(0.2f, 0.2f, 0.2f, 1.0f) );
	CKTDGParticleSystem::CParticleEventSequence* pParticleSL = pNPCUnit->GetMinorParticle_LUA( 0 );
    if( pParticleSL != NULL )
        pParticleSL->SetPosition( pNPCUnit->GetBonePos_LUA("Bone05") );


    if( pNPCUnit->AnimEventTimer_LUA( 0.25f ) )
    {
        pNPCUnit->PlaySound_LUA( "Energy.ogg" );

        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyLine",	bonePos, D3DXVECTOR2(40,80), D3DXVECTOR2(20,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetBlackHolePosition( bonePos );
                pParticle->UseLookPoint( true );
                pParticle->SetLookPoint( bonePos );
            }            

            CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
            if(pMajorParticle != NULL)
            {
                pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLightCenter",bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(-1,-1) );
                if( pParticle != NULL )
                {         
                    pNPCUnit->SetMinorParticle_LUA( 0, pParticle->GetHandle() );
                }
            }          
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 0.91f ) )
    {
        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_THIEF_FAT, pNPCUnit->GetHardLevel(), false, pos, true, 1.9f, true, 0 );
            }           

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, false );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_THIEF_THIN, pNPCUnit->GetHardLevel(), false, pos, true, 2.0f, true, 0 );
            }

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );

				const D3DXVECTOR3& vPos = pNPCUnit->GetPos();
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPosition( &vPos, 500.0f, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_THIEF_THIN, pNPCUnit->GetHardLevel(), false, pos, false, 2.1f, true, 0 );
            }

            g_pX2Game->FlushCreateNPCReq();
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 1.8f ) )
    {
		CKTDGParticleSystem::CParticleEventSequence *pParticleSL2 = pNPCUnit->GetMinorParticle_LUA( 0 );

        if( pParticleSL2 != NULL )
        {
            pParticleSL2->SetAutoDie();
            pNPCUnit->ClearMinorParticle_LUA( 0 );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{    
    if( pNPCUnit->AnimEventTimer_LUA( 0.15f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.1f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.24f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            CKTDGParticleSystem::CParticleEventSequence *pParticle;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5.0f;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );            
            pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5.0f );
        }        

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500.0f)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }       	
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.80f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.72f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_NORMAL_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}


// BendersUpgrade_Hard.lua
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_WAIT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_DASH_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_COMBO2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
        pNPCUnit->ClearHitUnitList_LUA();
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_COMBO_A_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );

    if( pNPCUnit->AnimEventTimer_LUA( 0.6f ) )
        pNPCUnit->ClearHitUnitList_LUA();

    if( pNPCUnit->AnimEventTimer_LUA( 0.6f ) )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );        

    if( pNPCUnit->AnimEventTimer_LUA( 1.6f ) )
        pNPCUnit->ClearHitUnitList_LUA();

    if( pNPCUnit->AnimEventTimer_LUA( 1.6f ) )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );

    if( pNPCUnit->AnimEventTimer_LUA( 1.6f ) )
        pNPCUnit->SetDamageData_LUA( "DAMAGE_DATA_LAST" );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_SUMMON_MONSTER_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->SetWorldColor_LUA( D3DXCOLOR(0.2f, 0.2f, 0.2f, 1.0f) );
	CKTDGParticleSystem::CParticleEventSequence* pParticleSL = pNPCUnit->GetMinorParticle_LUA( 0 );
    if( pParticleSL != NULL )
        pParticleSL->SetPosition( pNPCUnit->GetBonePos_LUA("Bone05") );


    if( pNPCUnit->AnimEventTimer_LUA( 0.25f ) )
    {
        pNPCUnit->PlaySound_LUA( "Energy.ogg" );

        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyLine",	bonePos, D3DXVECTOR2(40,80), D3DXVECTOR2(20,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetBlackHolePosition( bonePos );
                pParticle->UseLookPoint( true );
                pParticle->SetLookPoint( bonePos );
            }            

            CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
            if(pMajorParticle != NULL)
            {
                pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLightCenter",bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(-1,-1) );
                if( pParticle != NULL )
                {         
                    pNPCUnit->SetMinorParticle_LUA( 0, pParticle->GetHandle() );
                }
            }          
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 0.91f ) )
    {
        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_THIEF_FAT, pNPCUnit->GetHardLevel(), false, pos, true, 1.9f, true, 0 );
            }           

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, false );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_THIEF_THIN, pNPCUnit->GetHardLevel(), false, pos, true, 2.0f, true, 0 );
            }

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );

				const D3DXVECTOR3& vPos = pNPCUnit->GetPos();
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPosition( &vPos, 500.0f, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_THIEF_THIN, pNPCUnit->GetHardLevel(), false, pos, false, 2.1f, true, 0 );
            }

            g_pX2Game->FlushCreateNPCReq();
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 1.8f ) )
    {
		CKTDGParticleSystem::CParticleEventSequence *pParticleSL2 = pNPCUnit->GetMinorParticle_LUA( 0 );

        if( pParticleSL2 != NULL )
        {
            pParticleSL2->SetAutoDie();
            pNPCUnit->ClearMinorParticle_LUA( 0 );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{    
    if( pNPCUnit->AnimEventTimer_LUA( 0.15f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.1f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.24f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            CKTDGParticleSystem::CParticleEventSequence *pParticle;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5.0f;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );            
            pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5.0f );
        }        

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500.0f)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }       	
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.80f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.72f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_HARD_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}



// BendersUpgrade_Expert.lua
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_WAIT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_DASH_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_COMBO2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
        pNPCUnit->ClearHitUnitList_LUA();
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_COMBO_A_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.01f ) )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );

    if( pNPCUnit->AnimEventTimer_LUA( 0.6f ) )
        pNPCUnit->ClearHitUnitList_LUA();

    if( pNPCUnit->AnimEventTimer_LUA( 0.6f ) )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );        

    if( pNPCUnit->AnimEventTimer_LUA( 1.6f ) )
        pNPCUnit->ClearHitUnitList_LUA();

    if( pNPCUnit->AnimEventTimer_LUA( 1.6f ) )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );

    if( pNPCUnit->AnimEventTimer_LUA( 1.6f ) )
        pNPCUnit->SetDamageData_LUA( "DAMAGE_DATA_LAST" );
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_SUMMON_MONSTER_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    g_pX2Game->SetWorldColor_LUA( D3DXCOLOR(0.2f, 0.2f, 0.2f, 1.0f) );

	CKTDGParticleSystem::CParticleEventSequence* pParticleSL = pNPCUnit->GetMinorParticle_LUA( 0 );
    if( pParticleSL != NULL )
        pParticleSL->SetPosition( pNPCUnit->GetBonePos_LUA("Bone05") );


    if( pNPCUnit->AnimEventTimer_LUA( 0.25f ) )
    {
        pNPCUnit->PlaySound_LUA( "Energy.ogg" );

        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyLine",	bonePos, D3DXVECTOR2(40,80), D3DXVECTOR2(20,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetBlackHolePosition( bonePos );
                pParticle->UseLookPoint( true );
                pParticle->SetLookPoint( bonePos );
            }            

            CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
            if(pMajorParticle != NULL)
            {
                pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLightCenter",bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(-1,-1) );
                if( pParticle != NULL )
                {         
                    pNPCUnit->SetMinorParticle_LUA( 0, pParticle->GetHandle() );
                }
            }          
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 0.91f ) )
    {
        D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA("Bone05");
        CKTDGParticleSystem *pMajorParticle = g_pX2Game->GetMajorParticle();
        CKTDGParticleSystem::CParticleEventSequence *pParticle;

        if(pMajorParticle != NULL)
        {
            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_THIEF_FAT, pNPCUnit->GetHardLevel(), false, pos, true, 1.9f, true, 0 );
            }           

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPositionDir( &(pNPCUnit->GetPos()), 500.0f, true, false );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_THIEF_THIN, pNPCUnit->GetHardLevel(), false, pos, true, 2.0f, true, 0 );
            }

            pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SummonLight",	bonePos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(1,-1) );
            if(pParticle != NULL)
            {
                pParticle->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );

				const D3DXVECTOR3& vPos = pNPCUnit->GetPos();
                D3DXVECTOR3 pos = g_pX2Game->GetLineMap()->GetRandomPosition( &vPos, 500.0f, true );
                pParticle->SetBlackHolePosition( pos );
                g_pX2Game->PushCreateNPCReq_Lua( CX2UnitManager::NUI_THIEF_THIN, pNPCUnit->GetHardLevel(), false, pos, false, 2.1f, true, 0 );
            }

            g_pX2Game->FlushCreateNPCReq();
        }        
    }

    if( pNPCUnit->AnimEventTimer_LUA( 1.8f ) )
    {
		CKTDGParticleSystem::CParticleEventSequence *pParticleSL2 = pNPCUnit->GetMinorParticle_LUA( 0 );

        if( pParticleSL2 != NULL )
        {
            pParticleSL2->SetAutoDie();
            pNPCUnit->ClearMinorParticle_LUA( 0 );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{    
    if( pNPCUnit->AnimEventTimer_LUA( 0.15f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.1f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if( pMinorParticle != NULL )
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_FAT );
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_THIEF_THIN );
        }
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.24f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            CKTDGParticleSystem::CParticleEventSequence *pParticle;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5.0f;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );            
            pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5.0f );
        }        

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500.0f)
        {
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
        }       	
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.80f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.72f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::BENDERS_UPGRADE_EXPERT_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

void CX2GUNPCFunc::CHAIN_GATE_GREEN_WAIT_START_STATE( CX2GUNPC* pNPCUnit )
{
    CKTDGXSkinAnim *pXSkinAnim = pNPCUnit->GetXSkinAnimPtr().get();
    if(pXSkinAnim != NULL)
        pXSkinAnim->SetUseTex( 2, false );
}

void CX2GUNPCFunc::CHAIN_GATE_YELLOW_WAIT_START_STATE( CX2GUNPC* pNPCUnit )
{
    CKTDGXSkinAnim *pXSkinAnim = pNPCUnit->GetXSkinAnimPtr().get();
    if(pXSkinAnim != NULL)
        pXSkinAnim->SetUseTex( 2, false );
}

void CX2GUNPCFunc::CHAIN_GATE_RED_WAIT_START_STATE( CX2GUNPC* pNPCUnit )
{
    CKTDGXSkinAnim *pXSkinAnim = pNPCUnit->GetXSkinAnimPtr().get();
    if(pXSkinAnim != NULL)
        pXSkinAnim->SetUseTex( 2, false );
}

void CX2GUNPCFunc::CHAIN_GATE_EXTRA_WAIT_START_STATE( CX2GUNPC* pNPCUnit )
{
    CKTDGXSkinAnim *pXSkinAnim = pNPCUnit->GetXSkinAnimPtr().get();
    if(pXSkinAnim != NULL)
        pXSkinAnim->SetUseTex( 2, false );
}


// ChainGatePost.lua
void CX2GUNPCFunc::CHAIN_GATE_POST_BROKEN_START_STATE( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pParticle;
    float degreeY;

    if(pMinorParticle == NULL)
        return;

    pParticle= pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ChainGateLight1", pNPCUnit->GetBonePos_LUA( "COLLISION_SPHERE2" ), D3DXVECTOR2(1000,1000), D3DXVECTOR2(1,-1) );
    if(pParticle != NULL)
    {
        pNPCUnit->SetMinorParticle_LUA( 0, pParticle->GetHandle() );
        degreeY = pNPCUnit->GetXSkinAnimPtr()->GetMatrix().GetYRotateDegree() + 90.0f;
        pParticle->SetAddRotate( D3DXVECTOR3( 0.0f, degreeY, 0.0f ) );
    }    

    pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ChainGateLight2", pNPCUnit->GetBonePos_LUA( "COLLISION_SPHERE2" ), D3DXVECTOR2(1000,1000), D3DXVECTOR2(1,-1) );
    if(pParticle != NULL)
    {
        pNPCUnit->SetMinorParticle_LUA( 1, pParticle->GetHandle() );
        pParticle->SetAddRotate( D3DXVECTOR3( 0.0f, degreeY, 0.0f ) );
    }    
}


// ChainGatePostExtra.lua
void CX2GUNPCFunc::CHAIN_GATE_POST_EXTRA_BROKEN_START_STATE( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pParticle;
    float degreeY;

    if(pMinorParticle == NULL)
        return;

    pParticle= pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ChainGateLight1", pNPCUnit->GetBonePos_LUA( "COLLISION_SPHERE2" ), D3DXVECTOR2(1000,1000), D3DXVECTOR2(1,-1) );
    if(pParticle != NULL)
    {
        pNPCUnit->SetMinorParticle_LUA( 0, pParticle->GetHandle() );
        degreeY = pNPCUnit->GetXSkinAnimPtr()->GetMatrix().GetYRotateDegree() + 90.0f;
        pParticle->SetAddRotate( D3DXVECTOR3( 0.0f, degreeY, 0.0f ) );
    }    

    pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "ChainGateLight2", pNPCUnit->GetBonePos_LUA( "COLLISION_SPHERE2" ), D3DXVECTOR2(1000,1000), D3DXVECTOR2(1,-1) );
    if(pParticle != NULL)
    {
        pNPCUnit->SetMinorParticle_LUA( 1, pParticle->GetHandle() );
        pParticle->SetAddRotate( D3DXVECTOR3( 0.0f, degreeY, 0.0f ) );
    }    
}

//MonkeyBoss.lua
void CX2GUNPCFunc::MONKEY_BOSS_WAIT2_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.34f ) == true )
    {
        g_pX2Game->GetMinorParticle()->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOSS_WAIT3_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.7f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOSS_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MONKEY_BOSS_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MONKEY_BOSS_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MONKEY_BOSS_PUNCH_PUNCH_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {        
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

    if(pNPCUnit->AnimEventTimer_LUA( 0.9f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
    }

    if(pNPCUnit->AnimEventTimer_LUA( 0.9f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

    if(pNPCUnit->AnimEventTimer_LUA( 1.3f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
    }

    if(pNPCUnit->AnimEventTimer_LUA( 1.3f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

    if(pNPCUnit->AnimEventTimer_LUA( 2.0f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
        pNPCUnit->SetDamageData_LUA( "DAMAGE_DATA_LAST" );
    }

    if( pNPCUnit->AnimEventTimer_LUA( 2.0f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }
}
void CX2GUNPCFunc::MONKEY_BOSS_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOSS_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.06f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOSS_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.3f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOSS_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.2f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOSS_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOSS_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 1.15f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOSS_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 1.15f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MONKEY_BOSS_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

//Mushroom.lua
void CX2GUNPCFunc::MUSHROOM_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    float nowAnimTime = pNPCUnit->GetNowAnimationTime();

    if( nowAnimTime < 0.13f )
        pNPCUnit->SetSpeedX( 0.0f );
    else if( nowAnimTime > 0.45f )
        pNPCUnit->SetSpeedX( 0.0f );

    if( nowAnimTime > 0.13f && nowAnimTime < 0.14f )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
}
void CX2GUNPCFunc::MUSHROOM_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MUSHROOM_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MUSHROOM_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MUSHROOM_DAMAGE_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MUSHROOM_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.3f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MUSHROOM_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.2f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MUSHROOM_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MUSHROOM_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

//WoodenMushroom.lua
void CX2GUNPCFunc::MUSHROOM_WOODEN_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    float nowAnimTime = pNPCUnit->GetNowAnimationTime();

    if( nowAnimTime < 0.13f )
        pNPCUnit->SetSpeedX( 0.0f );
    else if( nowAnimTime > 0.45f )
        pNPCUnit->SetSpeedX( 0.0f );

    if( nowAnimTime > 0.13f && nowAnimTime < 0.14f )
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
}
void CX2GUNPCFunc::MUSHROOM_WOODEN_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MUSHROOM_WOODEN_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MUSHROOM_WOODEN_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::MUSHROOM_WOODEN_DAMAGE_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }
}
void CX2GUNPCFunc::MUSHROOM_WOODEN_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.3f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MUSHROOM_WOODEN_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.2f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MUSHROOM_WOODEN_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.44f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::MUSHROOM_WOODEN_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}

//WilliamPporu_Normal.lua
void CX2GUNPCFunc::WILLIAM_PPORU_WAIT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MUSHROOM );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MUSHROOM );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::WILLIAM_PPORU_DASH_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MUSHROOM );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_DASH_END_STATE_START( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::WILLIAM_PPORU_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::WILLIAM_PPORU_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::WILLIAM_PPORU_COMBO_ATTACK_A_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.5f ))
    {        
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

    if(pNPCUnit->AnimEventTimer_LUA( 0.9f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
    }

    if(pNPCUnit->AnimEventTimer_LUA( 1.1f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

    if(pNPCUnit->AnimEventTimer_LUA( 1.6f ))
    {
        pNPCUnit->ClearHitUnitList_LUA();
        pNPCUnit->SetDamageData_LUA( "DAMAGE_DATA_LAST" );
    }

    if( pNPCUnit->AnimEventTimer_LUA( 1.9f ))
    {
        pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MUSHROOM );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.06f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MUSHROOM );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.3f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.2f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.1f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }    
}
void CX2GUNPCFunc::WILLIAM_PPORU_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.5f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

		pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.5f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

		pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );

    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}


//WilliamPporu_Hard.lua
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_WAIT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MUSHROOM );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_WALK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MUSHROOM );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_WALK_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_DASH_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MUSHROOM );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_DASH_END_STATE_START( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_JUMP_DOWN_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_JUMP_DOWN_DIR_STATE_END( CX2GUNPC* pNPCUnit )
{
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    if(pMinorParticle != NULL)
        pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_ATTACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    // attack time 1.5 ~ 2.5
    float fTime;

    for(int i=1; i<=5; ++i)
    {
        fTime = 1.5f + i * 0.16f;

        if(pNPCUnit->AnimEventTimer_LUA( fTime ))
        {
            pNPCUnit->ClearHitUnitList_LUA();
            if(i == 5)
                pNPCUnit->SetDamageData_LUA( "DAMAGE_DATA_LAST" );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_COMBO_ATTACK_A_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	if(pNPCUnit->AnimEventTimer_LUA( 0.5f ))
	{        
		pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
	}

	if(pNPCUnit->AnimEventTimer_LUA( 0.9f ))
	{
		pNPCUnit->ClearHitUnitList_LUA();
	}

	if(pNPCUnit->AnimEventTimer_LUA( 1.1f ))
	{
		pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
	}

	if(pNPCUnit->AnimEventTimer_LUA( 1.6f ))
	{
		pNPCUnit->ClearHitUnitList_LUA();
		pNPCUnit->SetDamageData_LUA( "DAMAGE_DATA_LAST" );
	}

	if( pNPCUnit->AnimEventTimer_LUA( 1.9f ))
	{
		pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
	}
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_DAMAGE_SMALL_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.047f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MUSHROOM );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_DAMAGE_BIG_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.06f ))
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );
    }

    if(pNPCUnit->GetDamagedThisFrame())
    {
        float fRemainHPRate = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp();
        if( fRemainHPRate < 0.7f )
        {
            pNPCUnit->CallOtherNPC( CX2UnitManager::NUI_MUSHROOM );
        }
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_DAMAGE_DOWN_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.3f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_DAMAGE_DOWN_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.2f ) )
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_DAMAGE_AIR_DOWN_LANDING_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if(pNPCUnit->AnimEventTimer_LUA( 0.01f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        D3DXVECTOR3 pos = pNPCUnit->GetLandPosition_LUA();
        if(pMinorParticle != NULL)
        {
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
            pos.y = pos.y + 5;
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "GroundShockWave", pos, D3DXVECTOR2(100,100), D3DXVECTOR2(1,-1) );
            CKTDGParticleSystem::CParticleEventSequence *pParticle = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "AirDownTick", pNPCUnit->GetPos(), D3DXVECTOR2(200,200), D3DXVECTOR2(10,-1) );
            if(pParticle != NULL)
                pParticle->SetLandPosition( pos.y - 5 );
        }       

        if(GetDistance_LUA( pNPCUnit->GetPos(), g_pX2Game->GetFocusUnitPos_LUA() ) < 500)
            g_pX2Game->GetX2Camera()->GetCamera().UpDownCrashCameraNoReset( 10.0f, 0.1f );
    }
    else if(pNPCUnit->AnimEventTimer_LUA( 0.1f ))
    {
        pNPCUnit->PlaySound_LUA( "Down.ogg" );
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DownSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(7,-1) );
    }    
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_STAND_UP_ATTACK_FRONT_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.5f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

		pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }

}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_STAND_UP_ATTACK_BACK_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
    if( pNPCUnit->AnimEventTimer_LUA( 0.5f ) )
    {
        CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
        if(pMinorParticle != NULL)
            pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "StepSmoke", pNPCUnit->GetLandPosition_LUA(), D3DXVECTOR2(100,100), D3DXVECTOR2(5,-1) );

		pNPCUnit->SetSpeedX( pNPCUnit->GetWalkSpeed() );
    }
}
void CX2GUNPCFunc::WILLIAM_PPORU_HARD_DYING_LAND_STATE_START( CX2GUNPC* pNPCUnit )
{
    D3DXVECTOR3 pos = pNPCUnit->GetPos();
    pos.y = pos.y + 100.0f;
    CKTDGParticleSystem *pMinorParticle = g_pX2Game->GetMinorParticle();
    CKTDGParticleSystem::CParticleEventSequence *pSeq;

    if(pMinorParticle == NULL)
        return;

    pSeq = pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "DieLight",	pos, D3DXVECTOR2(-1,-1), D3DXVECTOR2(3,-1) );
    if( pSeq != NULL )
    {
        pSeq->SetLandPosition( pNPCUnit->GetLandPosition_LUA().y );
        pNPCUnit->SetDieSeq( pSeq->GetHandle() );
    }

    pNPCUnit->PlaySound_LUA( "DieLight.ogg" );
}


//GIANT_PPORU_RED
void CX2GUNPCFunc::GIANT_PPORU_RED_SPECIAL_ATTACK_A_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	if ( g_pX2Game != NULL )
	{
		if ( pNPCUnit != NULL )
		{
			if ( pNPCUnit->AnimEventTimer_LUA( 0.2f ) == true )
			{
				pNPCUnit->PlaySound_LUA( "Energy.ogg" );

				D3DXVECTOR3 bonePos = pNPCUnit->GetBonePos_LUA( "Bip01_L_Hand" );
				CKTDGParticleSystem* pMajorParticle = g_pX2Game->GetMajorParticle();
				if ( pMajorParticle != NULL )
				{
					pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyCenter",	bonePos, D3DXVECTOR2(20,40), D3DXVECTOR2(10,-1) );
					CKTDGParticleSystem::CParticleEventSequence* pParticle = pMajorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "SpecialEnergyLine", bonePos, D3DXVECTOR2(40,80), D3DXVECTOR2(20,-1) );
					if ( pParticle != NULL )
					{
						pParticle->SetBlackHolePosition( bonePos );
						pParticle->UseLookPoint( true );
						pParticle->SetLookPoint( bonePos );
					}
				}
			}

			if ( pNPCUnit->AnimEventTimer_LUA( 0.29f ) == true )
			{
				D3DXVECTOR3 pos = pNPCUnit->GetPos();
				D3DXVECTOR3 landPos = pNPCUnit->GetLandPosition_LUA();

				CX2DamageEffect* pDamageEffect = g_pX2Game->GetDamageEffect();
				if ( pDamageEffect != NULL )
				{
					pDamageEffect->CreateInstance_LUA(  pNPCUnit, "GIANTPPORURED_FIRE", pos, landPos.y );
				}

				pNPCUnit->PlaySound_LUA( "fire.ogg" );

				landPos.y = landPos.y + 10.0f;

				CKTDGParticleSystem* pMinorParticle = g_pX2Game->GetMinorParticle();
				if ( pMinorParticle != NULL )
				{
					pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "MagnumBladeFireWave", landPos, D3DXVECTOR2(10,10), D3DXVECTOR2(4, -1) );

					D3DXVECTOR3 projPos = g_pKTDXApp->GetProj3DPos( pos );
					projPos.z = 0;
					pMinorParticle->GameUnitCreateSequence_LUA( pNPCUnit, "STR_KuAAang", projPos, D3DXVECTOR2(100,100), D3DXVECTOR2(1, -1) );
				}

				pNPCUnit->SetNowMp( 0.f );
			}
		}
	}
}




// NUI_BARRIERMACHINE_FIRE
void CX2GUNPCFunc::BARRIER_CREATEMACHINE_FIRE_COMMON_FRAME_MOVE( CX2GUNPC* pNPCUnit  )
{
    float cHp;
    float hp = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp() * 100.0f;
    if(hp <= 30.0f)
    {
        cHp = pNPCUnit->GetMaxHp() * 0.3f;
        pNPCUnit->SetNowHp(cHp);
    }

	if( pNPCUnit->AnimEventTimer_LUA( 0.02f) )
	{
		CX2GUNPC* pNPC_ELE_Fire = g_pX2Game->GetNPCUnitByType( CX2UnitManager::NUI_NASOD_ELEMENT_FIRE );
		if( NULL == pNPC_ELE_Fire )
			return;

		if( pNPC_ELE_Fire->GetNowHp() <= 0.f )
			return;

		float fDist = GetDistance_LUA( pNPCUnit->GetPos(), pNPC_ELE_Fire->GetPos() );

		if( fDist > 1800.f )
		{
			pNPC_ELE_Fire->StateChange( "NASOD_ELEMENT_FIRE_TELEPORT" );
		}
	}
}




// NUI_BARRIERMACHINE_ICE
void CX2GUNPCFunc::BARRIER_CREATEMACHINE_ICE_COMMON_FRAME_MOVE( CX2GUNPC* pNPCUnit  )
{    
    float cHp;
    float hp = pNPCUnit->GetNowHp() / pNPCUnit->GetMaxHp() * 100.0f;
    if(hp <= 30.0f)
    {
        cHp = pNPCUnit->GetMaxHp() * 0.3f;
        pNPCUnit->SetNowHp(cHp);
    }
    

	if( pNPCUnit->AnimEventTimer_LUA( 0.02f) )
	{
		CX2GUNPC* pNPC_ELE_ICE = g_pX2Game->GetNPCUnitByType( CX2UnitManager::NUI_NASOD_ELEMENT_ICE );
		if( NULL == pNPC_ELE_ICE )
			return;

		if( pNPC_ELE_ICE->GetNowHp() <= 0.f )
			return;

		float fDist = GetDistance_LUA( pNPCUnit->GetPos(), pNPC_ELE_ICE->GetPos() );

		if( fDist > 1800.f )
		{
			pNPC_ELE_ICE->StateChange( "NASOD_ELEMENT_ICE_TELEPORT" );
		}
	}
}



//NUI_NASOD_ELEMENT_FIRE  
void CX2GUNPCFunc::NASOD_ELEMENT_FIRE_COMMON_FRAME_MOVE( CX2GUNPC* pNPCUnit  )
{
	if( pNPCUnit->GetNowHp() <= 0.f )
		return;

	bool bLiveBarrierMachine = false;
	CX2GUNPC* pNPC_Barrier_Fire = g_pX2Game->GetNPCUnitByType( CX2UnitManager::NUI_BARRIERMACHINE_FIRE );
	if( NULL != pNPC_Barrier_Fire )
	{
		if( pNPC_Barrier_Fire->GetFlag_LUA(3) == true )
		{
			bLiveBarrierMachine = true;
		}
	}

	if( true == bLiveBarrierMachine )
	{
		pNPCUnit->SetSuperArmorStateParam( true );
	}

	bool bDamaged = pNPCUnit->GetDamagedThisFrame();
	if( true == bDamaged && 
		true == bLiveBarrierMachine )
	{
		D3DXVECTOR3 vPos = pNPCUnit->GetPos();
		vPos.y += 180.f;
		D3DXVECTOR3 vRot = pNPCUnit->GetRotateDegree();

		if( pNPCUnit->GetAttackFront() == false )
		{
			vRot.y += 180.f;
		}

		CKTDGParticleSystem::CParticleEventSequence* pSeq1 = pNPCUnit->GetMajorParticle_LUA(1);
		if( INVALID_PARTICLE_SEQUENCE_HANDLE != pNPCUnit->GetMajorParticleHandle(1) )
		{
			if( NULL != pSeq1 )
			{
				pSeq1->SetPosition( vPos );
				pSeq1->SetAddRotate( vRot );
				pSeq1->SetAxisAngle( vRot );
			}
			else
			{
				pNPCUnit->ClearMajorParticle_LUA(1);
			}
		}
		else
		{
			pSeq1 = g_pX2Game->GetMajorParticle()->CreateSequence( (CKTDGObject*) pNPCUnit, L"Count_Barrier01", vPos );
			pSeq1->SetAddRotate( vRot );
			pSeq1->SetAxisAngle( vRot );
			pNPCUnit->SetMajorParticle_LUA( 1, pSeq1->GetHandle() );

			pNPCUnit->PlaySound_LUA( "Nasod_Element_BarrierHit.ogg" );
		}
	}
}

//NUI_NASOD_ELEMENT_ICE   
void CX2GUNPCFunc::NASOD_ELEMENT_ICE_COMMON_FRAME_MOVE( CX2GUNPC* pNPCUnit  )
{
	if( pNPCUnit->GetNowHp() <= 0.f )
		return;

	bool bLiveBarrierMachine = false;
	CX2GUNPC* pNPC_Barrier_Fire = g_pX2Game->GetNPCUnitByType( CX2UnitManager::NUI_BARRIERMACHINE_ICE );
	if( NULL != pNPC_Barrier_Fire )
	{
		if( pNPC_Barrier_Fire->GetFlag_LUA(3) == true )
		{
			bLiveBarrierMachine = true;
		}
	}

	if( true == bLiveBarrierMachine )
	{
		pNPCUnit->SetSuperArmorStateParam( true );
	}

	bool bDamaged = pNPCUnit->GetDamagedThisFrame();
	if( true == bDamaged && 
		true == bLiveBarrierMachine )
	{
		D3DXVECTOR3 vPos = pNPCUnit->GetPos();
		vPos.y += 180.f;
		D3DXVECTOR3 vRot = pNPCUnit->GetRotateDegree();

		if( pNPCUnit->GetAttackFront() == false )
		{
			vRot.y += 180.f;
		}


		CKTDGParticleSystem::CParticleEventSequence* pSeq1 = pNPCUnit->GetMajorParticle_LUA(1) ;
		if( INVALID_PARTICLE_SEQUENCE_HANDLE != pNPCUnit->GetMajorParticleHandle(1) )
		{
			if( NULL != pSeq1 )
			{
				pSeq1->SetPosition( vPos );
				pSeq1->SetAddRotate( vRot );
				pSeq1->SetAxisAngle( vRot );
			}
			else
			{
				pNPCUnit->ClearMajorParticle_LUA(1);
			}
		}
		else
		{
			pSeq1 = g_pX2Game->GetMajorParticle()->CreateSequence( (CKTDGObject*) pNPCUnit, L"Count_Barrier01", vPos );
			pSeq1->SetAddRotate( vRot );
			pSeq1->SetAxisAngle( vRot );
			pNPCUnit->SetMajorParticle_LUA( 1, pSeq1->GetHandle() );

			pNPCUnit->PlaySound_LUA( "Nasod_Element_BarrierHit.ogg" );
		}
	}
}


void CX2GUNPCFunc::BAT_A_FLY_STATE_START( CX2GUNPC* pNPCUnit )
{
	MONSTER_FLY_START( pNPCUnit, 1.5f );
}

void CX2GUNPCFunc::BAT_A_FLY_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	MONSTER_FLY_FRAME_MOVE( pNPCUnit );
}

void CX2GUNPCFunc::MONSTER_FLY_START( CX2GUNPC* pNPCUnit, float fTime, float fAdjustHeight )
{
	CX2GUUser* pGUUser = g_pX2Game->GetNearestUserUnitInSpecificRange( pNPCUnit->GetPos(), 0 );
	if ( pGUUser != NULL )
	{
		MONSTER_FLY_START_CALCULATE( pNPCUnit, fTime, fAdjustHeight, pGUUser );
	}
	else
	{
		pNPCUnit->StateChange( pNPCUnit->GetWaitStateID() );
	}	
}

void CX2GUNPCFunc::MONSTER_FLY_START_AT_HAVE_TARGET( CX2GUNPC* pNPCUnit, float fTime, float fAdjustHeight  )
{
	ASSERT( NULL != pNPCUnit->GetNPCAI() );
	if ( NULL != pNPCUnit->GetNPCAI() )
	{
		CX2GameUnit* pTargetGameUnit = pNPCUnit->GetNPCAI()->GetTargetGameUnit();

		if ( pTargetGameUnit != NULL )
		{
			MONSTER_FLY_START_CALCULATE( pNPCUnit, fTime, fAdjustHeight, pTargetGameUnit );
		}
		else
		{
			pNPCUnit->StateChange( pNPCUnit->GetWaitStateID() );
		}
	}
	else
		pNPCUnit->StateChange( pNPCUnit->GetWaitStateID() );
	
}

void CX2GUNPCFunc::MONSTER_FLY_FRAME_MOVE( CX2GUNPC* pNPCUnit )
{
	CX2GameUnit::LeapData* pLeapData = &pNPCUnit->GetLeapData();

	if ( pLeapData->m_fElapsedTimeToLeap >= pLeapData->m_fTimeToLeap )
		return;

#ifdef  X2OPTIMIZE_NPC_ADAPTIVE_FRAME_MOVE
    pLeapData->m_fElapsedTimeToLeap += pNPCUnit->GetElapsedTime();
#else   X2OPTIMIZE_NPC_ADAPTIVE_FRAME_MOVE
	pLeapData->m_fElapsedTimeToLeap += g_pKTDXApp->GetElapsedTime();
#endif  X2OPTIMIZE_NPC_ADAPTIVE_FRAME_MOVE


	D3DXVECTOR3 finalPos = pLeapData->m_StartPosToLeap;


	//   ?
	D3DXVECTOR3 tempPos;
	tempPos = pLeapData->m_DirVecToLeap;
	tempPos.y = 0;
	D3DXVec3Normalize( &tempPos, &tempPos );
	tempPos = ( /*tempPos*/pLeapData->m_DirVecToLeap * pLeapData->m_fElapsedTimeToLeap * pLeapData->m_fParallelSpeedToLeap);
	float fHeight = tempPos.y;

	finalPos.x += tempPos.x;
	finalPos.z += tempPos.z;
	finalPos.y += fHeight;

	D3DXVECTOR3 vecHeight = D3DXVECTOR3(0,0,0);
	vecHeight.y = ( ( pLeapData->m_fVerticalSpeedToLeap * pLeapData->m_fElapsedTimeToLeap ) - ( 0.5f * /*LEAP_GRAVITY*/ ( 2.0f * pLeapData->m_fHeightToLeap / pow( pLeapData->m_fTimeToLeap/2.0f, 2 ) ) * pow( pLeapData->m_fElapsedTimeToLeap, 2 ) )  );


	//x z   ?
	D3DXMATRIX matTrans;
	D3DXMatrixIdentity( &matTrans );
	D3DXMatrixRotationY( &matTrans, D3DXToRadian( 90 ) );
	D3DXVECTOR3 tempDirVec;	//       90  ?
	D3DXVec3TransformNormal( &tempDirVec, &pLeapData->m_DirVecToLeap, &matTrans );
	D3DXVec3Normalize( &tempDirVec, &tempDirVec );

	D3DXMatrixIdentity( &matTrans );
	D3DXMatrixRotationAxis( &matTrans, &tempDirVec, D3DXToRadian( pLeapData->m_DegreeToLeap ) );
	D3DXVECTOR4 transPos;
	D3DXVec3TransformCoord( &vecHeight, &vecHeight, &matTrans );

	finalPos += vecHeight;
	pNPCUnit->SetPosition( finalPos, pNPCUnit->GetIsRight() );

	// x.. 1,0,0
	
	D3DXVECTOR3 basicDir = D3DXVECTOR3(1,0,0);
	D3DXMatrixIdentity( &matTrans );
	D3DXMatrixRotationY( &matTrans, D3DXToRadian( -45 ) );
	D3DXVec3TransformNormal( &basicDir, &basicDir, &matTrans );

	D3DXVECTOR3 tempDir = D3DXVECTOR3(0,0,0);
	//xz y
	tempDir = D3DXVECTOR3( pLeapData->m_DirVecToLeap.x, 0, pLeapData->m_DirVecToLeap.z );
	D3DXVec3Normalize( &tempDir, &tempDir );
	float fDotValue = D3DXVec3Dot( &basicDir, &tempDir );
	//fDotValue /= D3DXVec3Length( &tempDir );
	float fRotateY = acos( fDotValue );

	/*
	//xy z
	tempDir = D3DXVECTOR3( pLeapData->m_DirVecToLeap.x, pLeapData->m_DirVecToLeap.y, 0 );
	basicDir = pLeapData->m_DirVecToLeap;
	fDotValue = D3DXVec3Dot( &tempDir, &basicDir );
	fDotValue /= D3DXVec3Length( &tempDir );
	float fRotateZ = acos( fDotValue ) * ( D3DXVec3Length( &tempDir ) );

	//yz x
	tempDir = D3DXVECTOR3( 0, pLeapData->m_DirVecToLeap.y, pLeapData->m_DirVecToLeap.z );
	basicDir = pLeapData->m_DirVecToLeap;
	fDotValue = D3DXVec3Dot( &tempDir, &basicDir );
	fDotValue /= D3DXVec3Length( &tempDir );
	float fRotateX = acos( fDotValue ) * ( D3DXVec3Length( &tempDir ) );
*/
	pNPCUnit->SetRotateDegree( D3DXVECTOR3( 0, D3DXToDegree( fRotateY ), 0 ) );

	if ( pLeapData->m_fElapsedTimeToLeap >= pLeapData->m_fTimeToLeap )
	{
		pNPCUnit->SetPosition( pLeapData->m_ArrivalPos, pNPCUnit->GetIsRight() );
		pNPCUnit->StateChange( pNPCUnit->GetWaitStateID() );
	}
}

void CX2GUNPCFunc::MONSTER_FLY_START_CALCULATE( CX2GUNPC* pNPCUnit, float fTime, float fAdjustHeight, CX2GameUnit* pGameUnit_ )
{
	if ( pNPCUnit == NULL || pGameUnit_ == NULL )
		return;

	pNPCUnit->GetNPCAI()->SetAttackerGameUnit( pGameUnit_ );

	CX2GameUnit::LeapData* pLeapData = &pNPCUnit->GetLeapData();

	pLeapData->m_fElapsedTimeToLeap = 0.0f;


	pLeapData->m_fTimeToLeap = fTime;

	pLeapData->m_StartPosToLeap = pNPCUnit->GetPos();


	D3DXVECTOR3 objectPos = pGameUnit_->GetPos();

	pLeapData->m_ArrivalPos = objectPos;

	D3DXVECTOR3 tempPos = objectPos - pNPCUnit->GetPos();
	//     ?

	D3DXVec3Normalize( &pLeapData->m_DirVecToLeap, &tempPos );

	float fHypotenuseLength = D3DXVec3Length( &tempPos );

	tempPos.y = 0;
	float fBaseLineLength = D3DXVec3Length( &tempPos );

	float radian = acosf( fBaseLineLength / fHypotenuseLength );
	float degree = D3DXToDegree( radian );
	degree = abs( degree );
	//   ?

	//  ?
	int degreeToLeap = 0;
	if ( degree >= 45 )
	{
		degreeToLeap = 45 - (int)degree;
	}
	else
	{
		degreeToLeap = 45;
	}

	if ( degreeToLeap < 10 )
		degreeToLeap = 10;


	//float fSpeedToLeap = sqrt( m_fHypotenuseLength * LEAP_GRAVITY / sin( D3DXToRadian(degreeToLeap*2) ) );

	// ? 
	//float fSpeedToLeap = (m_fTimeToLeap / 2.0f) * LEAP_GRAVITY / sin( D3DXToRadian(degreeToLeap) ); 

	/*
	float fSpeedToLeap = ( (2.0f * LEAP_GRAVITY * m_fTimeToLeap/2.0f) + 
	sqrt( pow( (2.0f*LEAP_GRAVITY*m_fTimeToLeap/2.0f), 2 ) - ( 4.0f * pow( sin( D3DXToRadian(degreeToLeap) ), 2 ) * pow( LEAP_GRAVITY, 2 ) * pow( m_fTimeToLeap/2.0f, 2 ) ) ) ) /
	( 2 * pow( sin( D3DXToRadian(degreeToLeap) ), 2 ) );
	*/
	//  100 ..



	//m_fVerticalSpeedToLeap = sqrt( 2.0f * LEAP_GRAVITY * 100 );
	//m_fVerticalSpeedToLeap = LEAP_GRAVITY * pow( m_fTimeToLeap / 2.0f, 2 );


	pLeapData->m_fParallelSpeedToLeap =  fBaseLineLength / pLeapData->m_fTimeToLeap;

	// 45  10.. ..  ?
	pLeapData->m_fHeightToLeap = fHypotenuseLength/fAdjustHeight;
	pLeapData->m_fHeightToLeap *= degreeToLeap/45.0f;
	//m_fVerticalSpeedToLeap = sin( D3DXToRadian(degreeToLeap) ) * fSpeedToLeap;
	pLeapData->m_fVerticalSpeedToLeap = 2.0f * pLeapData->m_fHeightToLeap / pow( pLeapData->m_fTimeToLeap/2.0f, 2 ) * (pLeapData->m_fTimeToLeap/2.0f); // g = ( 2.0f * 100.0f / pow( m_fTimeToLeap/2.0f, 2 ) );



	pLeapData->m_DegreeToLeap = (int)degree;
	
	
}
